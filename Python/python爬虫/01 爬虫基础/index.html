<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
<meta name="referrer" content="no-referrer">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/icon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/icon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yanglinqi107.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="内容来自黑马程序员 JSON在线解析及格式化验证 - JSON.cn">
<meta property="og:type" content="article">
<meta property="og:title" content="爬虫基础">
<meta property="og:url" content="http://yanglinqi107.github.io/Python/python%E7%88%AC%E8%99%AB/01%20%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="杨记">
<meta property="og:description" content="内容来自黑马程序员 JSON在线解析及格式化验证 - JSON.cn">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/爬虫分类.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/爬虫的工作流程.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/http作用.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/http的请求形式.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/http的响应形式.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/http发送的过程.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/requests-3-2-1-4.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/使用代理的过程-16726437579612.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/12306ssl错误.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/king-16726447328175.jpeg">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/formdata.jpeg">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/responsedata.jpeg">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/结构化响应内容json.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/非结构化响应内容html.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/xml树结构.gif">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/数据解析.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/jsonpath的方法.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/jsonpath使用示例.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/xpath_helper插件安装-3.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/节点.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/xpath中节点的关系.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img//image-20220119114803419.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img//image-20220119115053658.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img//image-20220119115001266.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/selenium的工作原理.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/image-20230104003502278.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/使用字体来反爬.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/通过css反爬.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/新建隐身窗口.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/chrome中network更多用途.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/勾选perservelog的效果.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/人人网登录的地址.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/人人网抓包寻找url地址.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/人人网手机版登录-16767034784476.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/js的绑定事件.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/searchallfile搜索关键字.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/点击美化输出.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/继续在其中搜索关键字.png">
<meta property="og:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/添加断点.png">
<meta property="article:published_time" content="2023-02-19T10:11:55.755Z">
<meta property="article:modified_time" content="2023-02-19T10:19:45.773Z">
<meta property="article:author" content="yanglinqi">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="爬虫">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/爬虫分类.png">

<link rel="canonical" href="http://yanglinqi107.github.io/Python/python%E7%88%AC%E8%99%AB/01%20%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>爬虫基础 | 杨记</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">杨记</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">碎片化学习令人焦虑，系统化学习使人进步</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">26</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">19</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">100</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yanglinqi107.github.io/Python/python%E7%88%AC%E8%99%AB/01%20%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/headpic.jpg">
      <meta itemprop="name" content="yanglinqi">
      <meta itemprop="description" content="用于做笔记，对学过的知识总结">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="杨记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          爬虫基础
        </h1>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-02-19 18:11:55 / 修改时间：18:19:45" itemprop="dateCreated datePublished" datetime="2023-02-19T18:11:55+08:00">2023-02-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/Python%E7%88%AC%E8%99%AB/" itemprop="url" rel="index"><span itemprop="name">Python爬虫</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>内容来自黑马程序员</p>
<p><a target="_blank" rel="noopener" href="https://www.json.cn/">JSON在线解析及格式化验证 - JSON.cn</a> </p>
<span id="more"></span>
<h3 id="爬虫基础"><a href="#爬虫基础" class="headerlink" title="爬虫基础"></a>爬虫基础</h3><h4 id="爬虫概述"><a href="#爬虫概述" class="headerlink" title="爬虫概述"></a>爬虫概述</h4><h5 id="爬虫的概念"><a href="#爬虫的概念" class="headerlink" title="爬虫的概念"></a>爬虫的概念</h5><p>模拟浏览器，发送请求，获取响应</p>
<p>网络爬虫（又被称为网页蜘蛛，网络机器人）就是模拟客户端(主要指浏览器)发送网络请求，接收请求响应，一种按照一定的规则，自动地抓取互联网信息的程序。</p>
<ul>
<li>原则上,只要是客户端(浏览器)能做的事情，爬虫都能够做</li>
<li>爬虫也只能获取客户端(浏览器)所展示出来的数据</li>
</ul>
<h5 id="爬虫的作用"><a href="#爬虫的作用" class="headerlink" title="爬虫的作用"></a>爬虫的作用</h5><blockquote>
<p>爬虫在互联网世界中有很多的作用，比如：</p>
</blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.lagou.com/jobs/list_Python 爬虫?labelWords=&amp;fromSearch=true&amp;suginput=">数据采集</a><ol>
<li><a target="_blank" rel="noopener" href="https://weibo.com/">抓取微博评论</a>(机器学习舆情监控)</li>
<li><a target="_blank" rel="noopener" href="https://www.lagou.com/jobs/list_python爬虫?px=default&amp;city=北京#filterBox">抓取招聘网站的招聘信息</a>(数据分析、挖掘)</li>
<li><a target="_blank" rel="noopener" href="https://news.sina.com.cn/roll/#pageid=153&amp;lid=2509&amp;k=&amp;num=50&amp;page=1">新浪滚动新闻</a></li>
<li><a target="_blank" rel="noopener" href="http://news.baidu.com/">百度新闻网站</a></li>
</ol>
</li>
<li><a target="_blank" rel="noopener" href="https://www.lagou.com/jobs/list_自动化测试?city=北京&amp;cl=false&amp;fromSearch=true&amp;labelWords=&amp;suginput=">软件测试</a><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/ZTZY520/article/details/53940127">爬虫之自动化测试</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/fnng/">虫师</a></li>
</ol>
</li>
<li><a target="_blank" rel="noopener" href="http://www.12306.cn/mormhweb/">12306抢票</a></li>
<li>网站上的投票<ol>
<li><a target="_blank" rel="noopener" href="https://www.toutoupiao.com/">投票网</a></li>
</ol>
</li>
<li>网络安全<ol>
<li><a target="_blank" rel="noopener" href="https://www.sohu.com/a/232477043_99936149">短信轰炸</a><ol>
<li><a target="_blank" rel="noopener" href="https://hwid1.vmall.com/CAS/portal/userRegister/regbyphone.html?reqClientType=1&amp;loginChannel=1000002&amp;countryCode=cn&amp;loginUrl=https%3A%2F%2Fhwid1.vmall.com%2FCAS%2Fportal%2FcloudLogin.html&amp;service=https%3A%2F%2Fwww.hicloud.com%3A443%2Fothers%2Flogin.action&amp;lang=zh-cn&amp;themeName=red">注册页面1</a></li>
<li><a target="_blank" rel="noopener" href="https://bcy.net/register">注册页面2</a></li>
<li><a target="_blank" rel="noopener" href="http://member.chinaacc.com/member/register.shtm">注册页面3</a></li>
</ol>
</li>
<li><a target="_blank" rel="noopener" href="https://paper.seebug.org/537/">web漏洞扫描</a></li>
</ol>
</li>
</ol>
<h5 id="爬虫的分类"><a href="#爬虫的分类" class="headerlink" title="爬虫的分类"></a>爬虫的分类</h5><p>根据被爬取网站的数量不同，可以分为：</p>
<ul>
<li>通用爬虫，如 搜索引擎</li>
<li>聚焦爬虫，如12306抢票，或专门抓取某一个（某一类）网站数据</li>
</ul>
<p>根据是否以获取数据为目的，可以分为：</p>
<ul>
<li>功能性爬虫，给你喜欢的明星投票、点赞</li>
<li>数据增量爬虫，比如招聘信息</li>
</ul>
<p>根据url地址和对应的页面内容是否改变，数据增量爬虫可以分为：</p>
<ul>
<li>基于url地址变化、内容也随之变化的数据增量爬虫</li>
<li>url地址不变、内容变化的数据增量爬虫</li>
</ul>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/爬虫分类.png" alt="爬虫的分类" style="zoom: 50%;" /></p>
<h5 id="爬虫的流程"><a href="#爬虫的流程" class="headerlink" title="爬虫的流程"></a>爬虫的流程</h5><p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/爬虫的工作流程.png" alt="爬虫的工作流程" style="zoom:50%;" /></p>
<ol>
<li>获取一个url</li>
<li>向url发送请求，并获取响应（需要http协议）</li>
<li>如果从响应中提取url，则继续发送请求获取响应</li>
<li>如果从响应中提取数据，则将数据进行保存</li>
</ol>
<h4 id="http协议复习"><a href="#http协议复习" class="headerlink" title="http协议复习"></a>http协议复习</h4><blockquote>
<p>一提起http协议，大家都会想起它是一个应用层协议，那么http协议跟爬虫有什么关系呢？请看下图：</p>
</blockquote>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/http作用.png" alt="http作用" style="zoom:50%;" /></p>
<p><strong>http和https的概念和区别</strong></p>
<blockquote>
<p>HTTPS比HTTP更安全，但是性能更低</p>
</blockquote>
<ul>
<li>HTTP：超文本传输协议，默认端口号是80<ul>
<li>超文本：是指超过文本，不仅限于文本；还包括图片、音频、视频等文件</li>
<li>传输协议：是指使用共用约定的固定格式来传递转换成字符串的超文本内容</li>
</ul>
</li>
<li>HTTPS：HTTP + SSL(安全套接字层)，即带有安全套接字层的超本文传输协，默认端口号：443<ul>
<li>SSL对传输的内容（超文本，也就是请求体或响应体）进行加密</li>
</ul>
</li>
<li>可以打开浏览器访问一个url，右键检查，点击net work，点选一个url，查看http协议的形式</li>
</ul>
<h5 id="请求头和响应头"><a href="#请求头和响应头" class="headerlink" title="请求头和响应头"></a>请求头和响应头</h5><p>1、特别关注的请求头字段：</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/http的请求形式.png" alt="http的请求形式" style="zoom:67%;" /></p>
<blockquote>
<p>http请求的形式如上图所示，爬虫特别关注以下几个请求头字段</p>
</blockquote>
<ul>
<li>Content-Type</li>
<li>Host (主机和端口号)</li>
<li>Connection (链接类型)</li>
<li>Upgrade-Insecure-Requests (升级为HTTPS请求)</li>
<li><strong>User-Agent</strong> (浏览器名称)</li>
<li><strong>Referer</strong> (页面跳转处)</li>
<li><strong>Cookie</strong> (Cookie)</li>
<li>Authorization(用于表示HTTP协议中需要认证资源的认证信息，如前边web课程中用于jwt认证)</li>
</ul>
<blockquote>
<p>加粗的请求头为常用请求头，在服务器被用来进行爬虫识别的频率最高，相较于其余的请求头更为重要，但是这里需要注意的是并不意味这其余的不重要，因为有的网站的运维或者开发人员可能剑走偏锋，会使用一些比较不常见的请求头来进行爬虫的甄别</p>
</blockquote>
<p>2、特别关注的响应头字段：</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/http的响应形式.png" alt="http的响应形式"></p>
<blockquote>
<p>http响应的形式如上图所示，爬虫只关注一个响应头字段</p>
</blockquote>
<ul>
<li>Set-Cookie （对方服务器设置cookie到用户浏览器的缓存）</li>
</ul>
<h5 id="响应状态码"><a href="#响应状态码" class="headerlink" title="响应状态码"></a>响应状态码</h5><ul>
<li>200：成功</li>
<li>302：跳转，新的url在响应的Location头中给出</li>
<li>303：浏览器对于POST的响应进行重定向至新的url</li>
<li>307：浏览器对于GET的响应重定向至新的url</li>
<li>403：资源不可用；服务器理解客户的请求，但拒绝处理它（没有权限）</li>
<li>404：找不到该页面</li>
<li>500：服务器内部错误</li>
<li>503：服务器由于维护或者负载过重未能应答，在响应中可能可能会携带Retry-After响应头；有可能是因为爬虫频繁访问url，使服务器忽视爬虫的请求，最终返回503响应状态码</li>
</ul>
<p>我们在学习web知识的时候就已经学过了状态码的相关知识，我们知道这是服务器给我的相关反馈，我们在学习的时候就被教育说应该将真实情况反馈给客户端，但是在爬虫中，可能该站点的开发人员或者运维人员为了阻止数据被爬虫轻易获取，可能在状态码上做手脚，也就是说返回的状态码并不一定就是真实情况，比如:服务器已经识别出你是爬虫，但是为了让你疏忽大意，所以照样返回状态码200，但是响应体重并没有数据。</p>
<p><strong>所有的状态码都不可信，一切以是否从抓包得到的响应中获取到数据为准</strong></p>
<h5 id="http请求过程"><a href="#http请求过程" class="headerlink" title="http请求过程"></a>http请求过程</h5><blockquote>
<p>在回顾完http协议后，我们来了解以下浏览器发送http请求的过程</p>
</blockquote>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/http发送的过程.png" alt="http发送的过程" style="zoom:67%;" /></p>
<ol>
<li>浏览器在拿到域名对应的ip后，先向地址栏中的url发起请求，并获取响应</li>
<li>在返回的响应内容（html）中，会带有css、js、图片等url地址，以及ajax代码，浏览器按照响应内容中的顺序依次发送其他的请求，并获取相应的响应</li>
<li>浏览器每获取一个响应就对展示出的结果进行添加（加载），js，css等内容会修改页面的内容，js也可以重新发送请求，获取响应</li>
<li>从获取第一个响应并在浏览器中展示，直到最终获取全部响应，并在展示的结果中添加内容或修改————这个过程叫做浏览器的<strong>渲染</strong></li>
</ol>
<h5 id="其它参考阅读"><a href="#其它参考阅读" class="headerlink" title="其它参考阅读"></a>其它参考阅读</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_33301113/article/category/6943422/2">https://blog.csdn.net/qq_33301113/article/category/6943422/2</a><br><a target="_blank" rel="noopener" href="https://www.xuebuyuan.com/3252125.html">https://www.xuebuyuan.com/3252125.html</a><br><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/http/243074?fr=aladdin">https://baike.baidu.com/item/http/243074?fr=aladdin</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/cc1fea7810b2">https://www.jianshu.com/p/cc1fea7810b2</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_30553235/article/details/79282113">https://blog.csdn.net/qq_30553235/article/details/79282113</a><br><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000002403462">https://segmentfault.com/q/1010000002403462</a></p>
<h3 id="requests模块"><a href="#requests模块" class="headerlink" title="requests模块"></a>requests模块</h3><p>requests官方文档：<a target="_blank" rel="noopener" href="https://cn.python-requests.org/zh_CN/latest/">Requests: 让 HTTP 服务人类 — Requests 2.18.1 文档 (python-requests.org)</a></p>
<p>requests模块是一个第三方模块，需要在你的python(虚拟)环境中额外安装：<code>pip/pip3 install requests</code></p>
<h4 id="简单get请求"><a href="#简单get请求" class="headerlink" title="简单get请求"></a>简单get请求</h4><ol>
<li>需求：通过requests向百度首页发送请求，获取该页面的源码</li>
<li>运行下面的代码，观察打印输出的结果</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标url</span></span><br><span class="line">url = <span class="string">&#x27;https://www.baidu.com&#x27;</span> </span><br><span class="line"><span class="comment"># 向目标url发送get请求</span></span><br><span class="line">response = requests.get(url)</span><br><span class="line"><span class="comment"># 打印响应内容</span></span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>
<h4 id="解决乱码"><a href="#解决乱码" class="headerlink" title="解决乱码"></a>解决乱码</h4><p>观察上边代码运行结果发现，有好多乱码；这是因为编解码使用的字符集不同早造成的；我们尝试使用下边的办法来解决中文乱码问题</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标url</span></span><br><span class="line">url = <span class="string">&#x27;https://www.baidu.com&#x27;</span> </span><br><span class="line"><span class="comment"># 向目标url发送get请求</span></span><br><span class="line">response = requests.get(url)</span><br><span class="line"><span class="comment"># 打印响应内容</span></span><br><span class="line"><span class="comment"># print(response.text)</span></span><br><span class="line"><span class="built_in">print</span>(response.content.decode()) <span class="comment"># 注意这里！</span></span><br></pre></td></tr></table></figure>
<ol>
<li><strong>response.text是requests模块按照chardet模块推测出的编码字符集进行解码的结果</strong></li>
<li>网络传输的字符串都是bytes类型的，所以response.text = response.content.decode(‘推测出的编码字符集’)</li>
<li>我们可以在网页源码中搜索<code>charset</code>，尝试参考该编码字符集，注意存在不准确的情况</li>
</ol>
<p><strong>response.text 和response.content的区别：</strong></p>
<ul>
<li>response.text<ul>
<li>类型：str</li>
<li>解码类型： requests模块自动根据HTTP 头部对响应的编码作出有根据的推测，推测的文本编码</li>
</ul>
</li>
<li>response.content<ul>
<li>类型：bytes</li>
<li>解码类型： 没有指定</li>
</ul>
</li>
</ul>
<p><strong>中文乱码常用字符集：</strong></p>
<ul>
<li><code>response.content.decode()</code> 默认utf-8</li>
<li><code>response.content.decode(&quot;GBK&quot;)</code></li>
<li>常见的编码字符集<ul>
<li>utf-8</li>
<li>gbk</li>
<li>gb2312</li>
<li>ascii</li>
<li>iso-8859-1</li>
</ul>
</li>
</ul>
<h4 id="响应对象"><a href="#响应对象" class="headerlink" title="响应对象"></a>响应对象</h4><blockquote>
<p><code>response = requests.get(url)</code>中response是发送请求获取的响应对象；response响应对象中除了text、content获取响应内容以外还有其它常用的属性或方法：</p>
</blockquote>
<ul>
<li><code>response.url</code>响应的url；有时候响应的url和请求的url并不一致</li>
<li><code>response.status_code</code> 响应状态码</li>
<li><code>response.request.headers</code> 响应对应的请求头</li>
<li><code>response.headers</code> 响应头</li>
<li><code>response.request._cookies</code> 响应对应请求的cookie；返回cookieJar类型</li>
<li><code>response.cookies</code> 响应的cookie（经过了set-cookie动作；返回cookieJar类型</li>
<li><code>response.json()</code>自动将json字符串类型的响应内容转换为python对象（dict or list）</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标url</span></span><br><span class="line">url = <span class="string">&#x27;https://www.baidu.com&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 向目标url发送get请求</span></span><br><span class="line">response = requests.get(url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印响应内容</span></span><br><span class="line"><span class="comment"># print(response.text)</span></span><br><span class="line"><span class="comment"># print(response.content.decode())             # 注意这里！</span></span><br><span class="line"><span class="built_in">print</span>(response.url)                            <span class="comment"># 打印响应的url</span></span><br><span class="line"><span class="built_in">print</span>(response.status_code)                    <span class="comment"># 打印响应的状态码</span></span><br><span class="line"><span class="built_in">print</span>(response.request.headers)                <span class="comment"># 打印响应对象的请求头</span></span><br><span class="line"><span class="built_in">print</span>(response.headers)                        <span class="comment"># 打印响应头</span></span><br><span class="line"><span class="built_in">print</span>(response.request._cookies)            <span class="comment"># 打印请求携带的cookies</span></span><br><span class="line"><span class="built_in">print</span>(response.cookies)                        <span class="comment"># 打印响应中携带的cookies</span></span><br></pre></td></tr></table></figure>
<h4 id="发送请求"><a href="#发送请求" class="headerlink" title="发送请求"></a>发送请求</h4><h5 id="携带请求头"><a href="#携带请求头" class="headerlink" title="携带请求头"></a>携带请求头</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requests.get(url, headers=headers)</span><br></pre></td></tr></table></figure>
<ul>
<li>headers参数接收字典形式的请求头</li>
<li>请求头字段名作为key，字段对应的值作为value</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://www.baidu.com&#x27;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在请求头中带上User-Agent，模拟浏览器发送请求</span></span><br><span class="line">response = requests.get(url, headers=headers) </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response.content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印请求头信息</span></span><br><span class="line"><span class="built_in">print</span>(response.request.headers)</span><br></pre></td></tr></table></figure>
<h5 id="携带参数字典"><a href="#携带参数字典" class="headerlink" title="携带参数字典"></a>携带参数字典</h5><blockquote>
<p>我们在使用百度搜索的时候经常发现url地址中会有一个 <code>?</code>，那么该问号后边的就是请求参数，又叫做查询字符串</p>
</blockquote>
<p> 1.构建请求参数字典</p>
<p> 2.向接口发送请求的时候带上参数字典，参数字典设置给params</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这是目标url</span></span><br><span class="line"><span class="comment"># url = &#x27;https://www.baidu.com/s?wd=python&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后有没有问号结果都一样</span></span><br><span class="line">url = <span class="string">&#x27;https://www.baidu.com/s?&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求参数是一个字典 即wd=python</span></span><br><span class="line">kw = &#123;<span class="string">&#x27;wd&#x27;</span>: <span class="string">&#x27;python&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 带上请求参数发起请求，获取响应</span></span><br><span class="line">response = requests.get(url, headers=headers, params=kw)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response.content)</span><br></pre></td></tr></table></figure>
<h5 id="携带cookie"><a href="#携带cookie" class="headerlink" title="携带cookie"></a>携带cookie</h5><blockquote>
<p>网站经常利用请求头中的Cookie字段来做用户访问状态的保持，那么我们可以在headers参数中添加Cookie，模拟普通用户的请求。我们以github登陆为例：</p>
</blockquote>
<p>github登陆抓包分析：</p>
<ol>
<li>打开浏览器，右键-检查，点击Net work，勾选Preserve log</li>
<li>访问github登陆的url地址 <code>https://github.com/login</code></li>
<li>输入账号密码点击登陆后，访问一个需要登陆后才能获取正确内容的url，比如点击右上角的Your profile访问<code>https://github.com/USER_NAME</code></li>
<li>确定url之后，再确定发送该请求所需要的请求头信息中的User-Agent和Cookie</li>
</ol>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/requests-3-2-1-4.png" alt="requests-3-2-1-4" style="zoom: 67%;" /></p>
<ul>
<li>从浏览器中复制User-Agent和Cookie</li>
<li>浏览器中的请求头字段和值与headers参数中必须一致</li>
<li>headers请求参数字典中的Cookie键对应的值是字符串</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://github.com/USER_NAME&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造请求头字典</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="comment"># 从浏览器中复制过来的User-Agent</span></span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.87 Safari/537.36&#x27;</span>,</span><br><span class="line">    <span class="comment"># 从浏览器中复制过来的Cookie</span></span><br><span class="line">    <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;xxx这里是复制过来的cookie字符串&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求头参数字典中携带cookie字符串</span></span><br><span class="line">resp = requests.get(url, headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>除了在headers参数中携带cookie，也可以使用专门的cookies参数</p>
</blockquote>
<ol>
<li><p>cookies参数的形式：字典</p>
<p><code>cookies = &#123;&quot;cookie的name&quot;:&quot;cookie的value&quot;&#125;</code></p>
<ul>
<li>该字典对应请求头中Cookie字符串，以分号、空格分割每一对字典键值对</li>
<li>等号左边的是一个cookie的name，对应cookies字典的key</li>
<li>等号右边对应cookies字典的value</li>
</ul>
</li>
<li><p>cookies参数的使用方法</p>
<p><code>response = requests.get(url, cookies)</code></p>
</li>
<li><p>将cookie字符串转换为cookies参数所需的字典：</p>
<p><code>cookies_dict = &#123;cookie.split(&#39;=&#39;)[0]:cookie.split(&#39;=&#39;)[-1] for cookie in cookies_str.split(&#39;; &#39;)&#125;</code></p>
</li>
<li><p>注意：<strong>cookie一般是有过期时间的，一旦过期需要重新获取</strong></p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://github.com/USER_NAME&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造请求头字典</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.87 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 构造cookies字典</span></span><br><span class="line">cookies_str = <span class="string">&#x27;从浏览器中copy过来的cookies字符串&#x27;</span></span><br><span class="line"></span><br><span class="line">cookies_dict = &#123;cookie.split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>]:cookie.split(<span class="string">&#x27;=&#x27;</span>)[-<span class="number">1</span>] <span class="keyword">for</span> cookie <span class="keyword">in</span> cookies_str.split(<span class="string">&#x27;; &#x27;</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求头参数字典中携带cookie字符串</span></span><br><span class="line">resp = requests.get(url, headers=headers, cookies=cookies_dict)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure>
<h5 id="cookieJar对象"><a href="#cookieJar对象" class="headerlink" title="cookieJar对象"></a>cookieJar对象</h5><blockquote>
<p>使用requests获取的resposne对象，具有cookies属性。该属性值是一个cookieJar类型，包含了对方服务器设置在本地的cookie。我们如何将其转换为cookies字典呢？</p>
</blockquote>
<ol>
<li><p>转换方法</p>
<p><code>cookies_dict = requests.utils.dict_from_cookiejar(response.cookies)</code></p>
</li>
<li><p>其中response.cookies返回的就是cookieJar类型的对象</p>
</li>
<li><p><code>requests.utils.dict_from_cookiejar</code>函数返回cookies字典</p>
</li>
</ol>
<h5 id="timeout超时"><a href="#timeout超时" class="headerlink" title="timeout超时"></a>timeout超时</h5><blockquote>
<p>在平时网上冲浪的过程中，我们经常会遇到网络波动，这个时候，一个请求等了很久可能任然没有结果。</p>
<p>在爬虫中，一个请求很久没有结果，就会让整个项目的效率变得非常低，这个时候我们就需要对请求进行强制要求，让他必须在特定的时间内返回结果，否则就报错。</p>
</blockquote>
<ol>
<li><p>超时参数timeout的使用方法</p>
<p><code>response = requests.get(url, timeout=3)</code></p>
</li>
<li><p>timeout=3表示：发送请求后，3秒钟内返回响应，否则就抛出异常</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://twitter.com&#x27;</span></span><br><span class="line">response = requests.get(url, timeout=<span class="number">3</span>)     <span class="comment"># 设置超时时间</span></span><br></pre></td></tr></table></figure>
<h5 id="proxies代理"><a href="#proxies代理" class="headerlink" title="proxies代理"></a>proxies代理</h5><p>proxy代理参数通过指定代理ip，让代理ip对应的正向代理服务器转发我们发送的请求，那么我们首先来了解一下代理ip以及代理服务器</p>
<ol>
<li>代理ip是一个ip，指向的是一个代理服务器</li>
<li>代理服务器能够帮我们向目标服务器转发请求</li>
</ol>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/使用代理的过程-16726437579612.png" alt="使用代理的过程" style="zoom:50%;" /></p>
<p><strong>正向代理和反向代理的区别</strong></p>
<blockquote>
<p>前边提到proxy参数指定的代理ip指向的是正向的代理服务器，那么相应的就有反向服务器；现在来了解一下正向代理服务器和反向代理服务器的区别</p>
</blockquote>
<ol>
<li>从发送请求的一方的角度，来区分正向或反向代理</li>
<li>为浏览器或客户端（发送请求的一方）转发请求的，叫做正向代理<ul>
<li>浏览器知道最终处理请求的服务器的真实ip地址，例如VPN</li>
</ul>
</li>
<li>不为浏览器或客户端（发送请求的一方）转发请求、而是为最终处理请求的服务器转发请求的，叫做反向代理<ul>
<li>浏览器不知道服务器的真实地址，例如nginx</li>
</ul>
</li>
</ol>
<p><strong>代理ip（代理服务器）的分类</strong></p>
<ol>
<li><p>根据代理ip的匿名程度，代理IP可以分为下面三类：</p>
<ul>
<li><p>透明代理(Transparent Proxy)：透明代理虽然可以直接“隐藏”你的IP地址，但是还是可以查到你是谁。目标服务器接收到的请求头如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REMOTE_ADDR = Proxy IP</span><br><span class="line">HTTP_VIA = Proxy IP</span><br><span class="line">HTTP_X_FORWARDED_FOR = Your IP</span><br></pre></td></tr></table></figure>
</li>
<li><p>匿名代理(Anonymous Proxy)：使用匿名代理，别人只能知道你用了代理，无法知道你是谁。目标服务器接收到的请求头如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REMOTE_ADDR = proxy IP</span><br><span class="line">HTTP_VIA = proxy IP</span><br><span class="line">HTTP_X_FORWARDED_FOR = proxy IP</span><br></pre></td></tr></table></figure>
</li>
<li><p>高匿代理(Elite proxy或High Anonymity Proxy)：高匿代理让别人根本无法发现你是在用代理，所以是最好的选择。<strong>毫无疑问使用高匿代理效果最好</strong>。目标服务器接收到的请求头如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REMOTE_ADDR = Proxy IP</span><br><span class="line">HTTP_VIA = not determined</span><br><span class="line">HTTP_X_FORWARDED_FOR = not determined</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>根据网站所使用的协议不同，需要使用相应协议的代理服务。从代理服务请求使用的协议可以分为：</p>
<ul>
<li>http代理：目标url为http协议</li>
<li>https代理：目标url为https协议</li>
<li>socks隧道代理（例如socks5代理）等：<ol>
<li>socks 代理只是简单地传递数据包，不关心是何种应用协议（FTP、HTTP和HTTPS等）。</li>
<li>socks 代理比http、https代理耗时少。</li>
<li>socks 代理可以转发http和https的请求</li>
</ol>
</li>
</ul>
</li>
</ol>
<p><strong>proxies代理参数的使用</strong></p>
<blockquote>
<p>为了让服务器以为不是同一个客户端在请求；为了防止频繁向一个域名发送请求被封ip，所以我们需要使用代理ip；那么我们接下来要学习requests模块是如何使用代理ip的</p>
</blockquote>
<ul>
<li><p>用法：<code>response = requests.get(url, proxies=proxies)</code></p>
</li>
<li><p>proxies的形式：字典</p>
</li>
<li><p>例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">proxies = &#123; </span><br><span class="line">    <span class="string">&quot;http&quot;</span>: <span class="string">&quot;http://12.34.56.79:9527&quot;</span>, </span><br><span class="line">    <span class="string">&quot;https&quot;</span>: <span class="string">&quot;https://12.34.56.79:9527&quot;</span>, </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意：如果proxies字典中包含有多个键值对，发送请求时将按照url地址的协议来选择使用相应的代理ip</p>
</li>
</ul>
<h5 id="verify参数"><a href="#verify参数" class="headerlink" title="verify参数"></a>verify参数</h5><p>在使用浏览器上网的时候，有时能够看到下面的提示（2018年10月之前的12306网站）：</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/12306ssl错误.png" alt="12306ssl错误" style="zoom: 33%;" /></p>
<ul>
<li>原因：该网站的CA证书没有经过【受信任的根证书颁发机构】的认证</li>
<li><strong><a target="_blank" rel="noopener" href="https://blog.csdn.net/yangyuge1987/article/details/79209473/">关于CA证书以及受信任的根证书颁发机构点击了解更多</a></strong></li>
</ul>
<p>使用<code>verify=False</code>参数，此时requests模块发送请求将不做CA证书的验证：verify参数能够忽略CA证书的认证</p>
<p><code>response = requests.get(url,verify=False)</code></p>
<h4 id="post请求"><a href="#post请求" class="headerlink" title="post请求"></a>post请求</h4><blockquote>
<p>思考：哪些地方我们会用到POST请求？</p>
<ol>
<li>登录注册（ 在web工程师看来POST 比 GET 更安全，url地址中不会暴露用户的账号密码等信息）</li>
<li>需要传输大文本内容的时候（ POST 请求对数据长度没有要求）</li>
</ol>
<p>所以同样的，我们的爬虫也需要在这两个地方回去模拟浏览器发送post请求</p>
</blockquote>
<p><strong>requests发送post请求的方法</strong>：</p>
<ul>
<li><code>response = requests.post(url, data)</code></li>
<li><code>data</code>参数接收一个字典</li>
<li><strong>requests模块发送post请求函数的其它参数和发送get请求的参数完全一致</strong></li>
</ul>
<p>下面面我们通过金山翻译的例子看看post请求如何使用：</p>
<ol>
<li>地址：<a target="_blank" rel="noopener" href="http://fy.iciba.com/">http://fy.iciba.com/</a></li>
</ol>
<h5 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h5><ol>
<li><p>抓包确定请求的url地址</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/king-16726447328175.jpeg" alt="img" style="zoom: 33%;" /></p>
</li>
<li><p>确定请求的参数</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/formdata.jpeg" alt="img" style="zoom:50%;" /></p>
</li>
<li><p>确定返回数据的位置</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/responsedata.jpeg" alt="img" style="zoom: 33%;" /></p>
</li>
</ol>
<p>分析结果：</p>
<ol>
<li><p>url地址：<code>http://fy.iciba.com/</code></p>
</li>
<li><p>请求方法：POST</p>
</li>
<li><p>请求所需参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;f&#x27;</span>: <span class="string">&#x27;auto&#x27;</span>, <span class="comment"># 表示被翻译的语言是自动识别</span></span><br><span class="line">    <span class="string">&#x27;t&#x27;</span>: <span class="string">&#x27;auto&#x27;</span>, <span class="comment"># 表示翻译后的语言是自动识别</span></span><br><span class="line">    <span class="string">&#x27;w&#x27;</span>: <span class="string">&#x27;人生苦短&#x27;</span> <span class="comment"># 要翻译的中文字符串</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">King</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, word</span>):</span></span><br><span class="line">        self.url = <span class="string">&quot;http://fy.iciba.com/ajax.php?a=fy&quot;</span></span><br><span class="line">        self.word = word</span><br><span class="line">        self.headers = &#123;</span><br><span class="line">            <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        self.post_data = &#123;</span><br><span class="line">            <span class="string">&quot;f&quot;</span>: <span class="string">&quot;auto&quot;</span>,</span><br><span class="line">            <span class="string">&quot;t&quot;</span>: <span class="string">&quot;auto&quot;</span>,</span><br><span class="line">            <span class="string">&quot;w&quot;</span>: self.word</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_data</span>(<span class="params">self</span>):</span></span><br><span class="line">        response = requests.post(self.url, headers=self.headers, data=self.post_data)</span><br><span class="line">        <span class="comment"># 默认返回bytes类型，除非确定外部调用使用str才进行解码操作</span></span><br><span class="line">        <span class="keyword">return</span> response.content</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_data</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="comment"># 将json数据转换成python字典</span></span><br><span class="line">        dict_data = json.loads(data)</span><br><span class="line">        <span class="comment"># 从字典中抽取翻译结果</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(dict_data[<span class="string">&#x27;content&#x27;</span>][<span class="string">&#x27;out&#x27;</span>])</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(dict_data[<span class="string">&#x27;content&#x27;</span>][<span class="string">&#x27;word_mean&#x27;</span>][<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># url</span></span><br><span class="line">        <span class="comment"># headers</span></span><br><span class="line">        <span class="comment"># post——data</span></span><br><span class="line">        <span class="comment"># 发送请求</span></span><br><span class="line">        data = self.get_data()</span><br><span class="line">        <span class="comment"># 解析</span></span><br><span class="line">        self.parse_data(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># king = King(&quot;人生苦短，及时行乐&quot;)</span></span><br><span class="line">    king = King(<span class="string">&quot;China&quot;</span>)</span><br><span class="line">    king.run()</span><br></pre></td></tr></table></figure>
<h4 id="session"><a href="#session" class="headerlink" title="session"></a>session</h4><blockquote>
<p>requests模块中的Session类能够自动处理发送请求获取响应过程中产生的cookie，进而达到状态保持的目的。接下来我们就来学习它</p>
</blockquote>
<p><strong>requests.session的作用以及应用场景</strong></p>
<ul>
<li>requests.session的作用<ul>
<li>自动处理cookie，即 <strong>下一次请求会带上前一次的cookie</strong></li>
</ul>
</li>
<li>requests.session的应用场景<ul>
<li>自动处理连续的多次请求过程中产生的cookie</li>
</ul>
</li>
</ul>
<p><strong>requests.session使用方法</strong>：</p>
<blockquote>
<p>session实例在请求了一个网站后，对方服务器设置在本地的cookie会保存在session中，下一次再使用session请求对方服务器的时候，会带上前一次的cookie</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">session = requests.session() <span class="comment"># 实例化session对象</span></span><br><span class="line">response = session.get(url, headers, ...)</span><br><span class="line">response = session.post(url, data, ...)</span><br></pre></td></tr></table></figure>
<ul>
<li>session对象发送get或post请求的参数，与requests模块发送请求的参数完全一致</li>
</ul>
<p>使用requests.session来完成github登陆，并获取需要登陆后才能访问的页面：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造请求头字典</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.87 Safari/537.36&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例化session对象</span></span><br><span class="line">session = requests.session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问登陆页获取登陆请求所需参数</span></span><br><span class="line">response = session.get(<span class="string">&#x27;https://github.com/login&#x27;</span>, headers=headers)</span><br><span class="line">authenticity_token = re.search(<span class="string">&#x27;name=&quot;authenticity_token&quot; value=&quot;(.*?)&quot; /&gt;&#x27;</span>, response.text).group(<span class="number">1</span>) <span class="comment"># 使用正则获取登陆请求所需参数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造登陆请求参数字典</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;commit&#x27;</span>: <span class="string">&#x27;Sign in&#x27;</span>, <span class="comment"># 固定值</span></span><br><span class="line">    <span class="string">&#x27;utf8&#x27;</span>: <span class="string">&#x27;✓&#x27;</span>, <span class="comment"># 固定值</span></span><br><span class="line">    <span class="string">&#x27;authenticity_token&#x27;</span>: authenticity_token, <span class="comment"># 该参数在登陆页的响应内容中</span></span><br><span class="line">    <span class="string">&#x27;login&#x27;</span>: <span class="built_in">input</span>(<span class="string">&#x27;输入github账号：&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: <span class="built_in">input</span>(<span class="string">&#x27;输入github账号：&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送登陆请求（无需关注本次请求的响应）</span></span><br><span class="line">session.post(<span class="string">&#x27;https://github.com/session&#x27;</span>, headers=headers, data=data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印需要登陆后才能访问的页面</span></span><br><span class="line">response = session.get(<span class="string">&#x27;https://github.com/1596930226&#x27;</span>, headers=headers)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>
<h3 id="数据提取"><a href="#数据提取" class="headerlink" title="数据提取"></a>数据提取</h3><h4 id="响应内容分类"><a href="#响应内容分类" class="headerlink" title="响应内容分类"></a>响应内容分类</h4><blockquote>
<p>在发送请求获取响应之后，可能存在多种不同类型的响应内容；而且很多时候，我们只需要响应内容中的一部分数据</p>
</blockquote>
<p>1、结构化的响应内容</p>
<ul>
<li><p>json字符串</p>
<ul>
<li><p>可以使用re、json等模块来提取特定数据</p>
</li>
<li><p>json字符串的例子如下图</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/结构化响应内容json.png" alt="结构化响应内容json" style="zoom: 50%;" /></p>
</li>
</ul>
</li>
<li><p>xml字符串</p>
<ul>
<li><p>可以使用re、lxml等模块来提取特定数据</p>
</li>
<li><p>xml字符串的例子如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bookstore</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">book</span> <span class="attr">category</span>=<span class="string">&quot;COOKING&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span>Everyday Italian<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">author</span>&gt;</span>Giada De Laurentiis<span class="tag">&lt;/<span class="name">author</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">year</span>&gt;</span>2005<span class="tag">&lt;/<span class="name">year</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">price</span>&gt;</span>30.00<span class="tag">&lt;/<span class="name">price</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">book</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">book</span> <span class="attr">category</span>=<span class="string">&quot;CHILDREN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span>Harry Potter<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">author</span>&gt;</span>J K. Rowling<span class="tag">&lt;/<span class="name">author</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">year</span>&gt;</span>2005<span class="tag">&lt;/<span class="name">year</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">price</span>&gt;</span>29.99<span class="tag">&lt;/<span class="name">price</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">book</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">book</span> <span class="attr">category</span>=<span class="string">&quot;WEB&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span>Learning XML<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">author</span>&gt;</span>Erik T. Ray<span class="tag">&lt;/<span class="name">author</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">year</span>&gt;</span>2003<span class="tag">&lt;/<span class="name">year</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">price</span>&gt;</span>39.95<span class="tag">&lt;/<span class="name">price</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">book</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bookstore</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>2、非结构化的响应内容</p>
<ul>
<li><p>html字符串</p>
<ul>
<li><p>可以使用re、lxml等模块来提取特定数据</p>
</li>
<li><p>html字符串的例子如下图</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/非结构化响应内容html.png" alt="非结构化响应内容html" style="zoom: 50%;" /></p>
</li>
</ul>
</li>
</ul>
<h4 id="xml和html"><a href="#xml和html" class="headerlink" title="xml和html"></a>xml和html</h4><blockquote>
<p>xml是一种可扩展标记语言，样子和html很像，功能更专注于对传输和存储数据</p>
</blockquote>
<p><strong>上面的xml内容可以表示为下面的树结构：</strong></p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/xml树结构.gif" alt="xml树结构" style="zoom:80%;" /></p>
<p><strong>xml和html的区别如下图</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>数据格式</th>
<th>描述</th>
<th>设计目标</th>
</tr>
</thead>
<tbody>
<tr>
<td>XML</td>
<td>Extensible Markup Language（可扩展标记语言）</td>
<td>被设计为传输和存储数据，其焦点是数据的内容</td>
</tr>
<tr>
<td>HTML</td>
<td>HyperText Markup Language（超文本标记语言）</td>
<td>更好的显示数据</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>html：<ul>
<li>超文本标记语言</li>
<li>为了更好的显示数据，侧重点是为了显示</li>
</ul>
</li>
<li>xml：<ul>
<li>可扩展标记语言</li>
<li>为了传输和存储数据，侧重点是在于数据内容本身</li>
</ul>
</li>
</ul>
<h4 id="数据解析方法"><a href="#数据解析方法" class="headerlink" title="数据解析方法"></a>数据解析方法</h4><p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/数据解析.png" alt="常用数据解析方法" style="zoom: 40%;" /></p>
<h3 id="jsonpath模块"><a href="#jsonpath模块" class="headerlink" title="jsonpath模块"></a>jsonpath模块</h3><blockquote>
<p>如果有一个多层嵌套的复杂字典，想要根据key和下标来批量提取value，这是比较困难的。jsonpath模块就能解决这个痛点，接下来我们就来学习jsonpath模块</p>
</blockquote>
<p><strong>jsonpath可以按照key对python字典进行批量数据提取</strong></p>
<p>jsonpath是第三方模块，需要额外安装：<code>pip install jsonpath</code></p>
<p><strong>提取数据的方法：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> jsonpath <span class="keyword">import</span> jsonpath</span><br><span class="line">ret = jsonpath(a, <span class="string">&#x27;jsonpath语法规则字符串&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="语法规则"><a href="#语法规则" class="headerlink" title="语法规则"></a>语法规则</h4><p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/jsonpath的方法.png" alt="jsonpath的方法" style="zoom: 40%;" /></p>
<h4 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">book_dict = &#123; </span><br><span class="line">  <span class="string">&quot;store&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;book&quot;</span>: [ </span><br><span class="line">      &#123; <span class="string">&quot;category&quot;</span>: <span class="string">&quot;reference&quot;</span>,</span><br><span class="line">        <span class="string">&quot;author&quot;</span>: <span class="string">&quot;Nigel Rees&quot;</span>,</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Sayings of the Century&quot;</span>,</span><br><span class="line">        <span class="string">&quot;price&quot;</span>: <span class="number">8.95</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="string">&quot;category&quot;</span>: <span class="string">&quot;fiction&quot;</span>,</span><br><span class="line">        <span class="string">&quot;author&quot;</span>: <span class="string">&quot;Evelyn Waugh&quot;</span>,</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Sword of Honour&quot;</span>,</span><br><span class="line">        <span class="string">&quot;price&quot;</span>: <span class="number">12.99</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="string">&quot;category&quot;</span>: <span class="string">&quot;fiction&quot;</span>,</span><br><span class="line">        <span class="string">&quot;author&quot;</span>: <span class="string">&quot;Herman Melville&quot;</span>,</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Moby Dick&quot;</span>,</span><br><span class="line">        <span class="string">&quot;isbn&quot;</span>: <span class="string">&quot;0-553-21311-3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;price&quot;</span>: <span class="number">8.99</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="string">&quot;category&quot;</span>: <span class="string">&quot;fiction&quot;</span>,</span><br><span class="line">        <span class="string">&quot;author&quot;</span>: <span class="string">&quot;J. R. R. Tolkien&quot;</span>,</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;The Lord of the Rings&quot;</span>,</span><br><span class="line">        <span class="string">&quot;isbn&quot;</span>: <span class="string">&quot;0-395-19395-8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;price&quot;</span>: <span class="number">22.99</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;bicycle&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;color&quot;</span>: <span class="string">&quot;red&quot;</span>,</span><br><span class="line">      <span class="string">&quot;price&quot;</span>: <span class="number">19.95</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> jsonpath <span class="keyword">import</span> jsonpath</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(jsonpath(book_dict, <span class="string">&#x27;$..author&#x27;</span>)) <span class="comment"># 如果取不到将返回False # 返回列表，如果取不到将返回False</span></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/jsonpath使用示例.png" alt="jsonpath使用示例" style="zoom:80%;" /></p>
<h4 id="jsonpath练习"><a href="#jsonpath练习" class="headerlink" title="jsonpath练习"></a>jsonpath练习</h4><p>我们以拉勾网城市JSON文件 <a target="_blank" rel="noopener" href="http://www.lagou.com/lbs/getAllCitySearchLabels.json">http://www.lagou.com/lbs/getAllCitySearchLabels.json</a> 为例，获取所有城市的名字的列表，并写入文件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> jsonpath</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取拉勾网城市json字符串</span></span><br><span class="line">url = <span class="string">&#x27;http://www.lagou.com/lbs/getAllCitySearchLabels.json&#x27;</span></span><br><span class="line">headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)&quot;</span>&#125;</span><br><span class="line">response =requests.get(url, headers=headers)</span><br><span class="line">html_str = response.content.decode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把json格式字符串转换成python对象</span></span><br><span class="line">jsonobj = json.loads(html_str)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从根节点开始，获取所有key为name的值</span></span><br><span class="line">citylist = jsonpath.jsonpath(jsonobj,<span class="string">&#x27;$..name&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;city_name.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = json.dumps(citylist, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">    f.write(content)</span><br></pre></td></tr></table></figure>
<h3 id="xpath"><a href="#xpath" class="headerlink" title="xpath"></a>xpath</h3><blockquote>
<p>对html或xml形式的文本提取特定的内容，就需要我们掌握lxml模块的使用和xpath语法。</p>
</blockquote>
<ul>
<li>lxml模块可以利用XPath规则语法，来快速的定位HTML\XML 文档中特定元素以及获取节点信息（文本内容、属性值）</li>
<li>XPath (XML Path Language) 是一门在 HTML\XML 文档中查找信息的语言，可用来在 HTML\XML 文档中对元素和属性进行遍历。<ul>
<li>W3School官方文档：<a target="_blank" rel="noopener" href="http://www.w3school.com.cn/xpath/index.asp">http://www.w3school.com.cn/xpath/index.asp</a></li>
</ul>
</li>
<li>提取xml、html中的数据需要lxml模块和xpath语法配合使用</li>
</ul>
<h4 id="xpath-helper"><a href="#xpath-helper" class="headerlink" title="xpath helper"></a>xpath helper</h4><p>xpath helper是一款浏览器插件，可以帮助我们查看xpath语法对应的网页元素</p>
<p>下载Chrome插件 XPath Helper</p>
<ul>
<li>可以在chrome应用商城进行下载，可能无法下载</li>
<li>从该链接进行下载<a target="_blank" rel="noopener" href="https://chrome.zzzmh.cn/info/hgimnogjllphhhkhlmebbmlgjoejdpjl">XPath Helper_2.0.2_chrome扩展插件最新版下载_极简插件 (zzzmh.cn)</a></li>
</ul>
<p>访问url之后在页面中点击xpath图标，就可以使用了：</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/xpath_helper插件安装-3.png" alt="xpath_helper插件安装-3" style="zoom: 67%;" /></p>
<h4 id="xpath的节点"><a href="#xpath的节点" class="headerlink" title="xpath的节点"></a>xpath的节点</h4><blockquote>
<p>学习xpath语法需要先了解xpath中的节点关系</p>
</blockquote>
<p>每个html、xml的标签我们都称之为节点，其中最顶层的节点称为根节点。我们以xml为例，html也是一样的</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/节点.png" alt="节点" style="zoom: 33%;" /></p>
<p><strong>节点的关系</strong>：</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/xpath中节点的关系.png" alt="xpath中节点的关系" style="zoom:50%;" /></p>
<ul>
<li><strong><code>author</code>是<code>title</code>的第一个兄弟节点</strong></li>
</ul>
<h4 id="xpath语法"><a href="#xpath语法" class="headerlink" title="xpath语法"></a>xpath语法</h4><p><strong>1、xpath语法-基础节点选择语法</strong></p>
<ol>
<li>XPath 使用路径表达式来选取 XML 文档中的节点或者节点集。</li>
<li>这些路径表达式和我们在常规的<strong>电脑文件系统中看到的表达式</strong>非常相似。</li>
<li><strong>使用chrome插件选择标签时候，选中时，选中的标签会添加属性class=”xh-highlight”</strong></li>
</ol>
<p><strong>xpath定位节点以及提取属性或文本内容的语法</strong>：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>表达式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>nodename</td>
<td>选中该元素</td>
</tr>
<tr>
<td>/</td>
<td>从根节点选取、或者是元素和元素间的过渡</td>
</tr>
<tr>
<td>//</td>
<td>从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置</td>
</tr>
<tr>
<td>.</td>
<td>选取当前节点</td>
</tr>
<tr>
<td>..</td>
<td>选取当前节点的父节点</td>
</tr>
<tr>
<td>@</td>
<td>选取属性</td>
</tr>
<tr>
<td>text()</td>
<td>选取文本</td>
</tr>
</tbody>
</table>
</div>
<p>语法练习，接下来我们通过itcast的页面来练习上述语法：<a target="_blank" rel="noopener" href="http://www.itcast.cn/">http://www.itcast.cn/</a></p>
<ul>
<li>选择所有的h2下的文本：<code>//h2/text()</code></li>
<li>获取所有的a标签的href：<code>//a/@href</code></li>
<li>获取html下的head下的title的文本：<code>/html/head/title/text()</code></li>
<li>获取html下的head下的link标签的href：<code>/html/head/link/@href</code></li>
</ul>
<p><strong>2、xpath语法-节点修饰语法</strong></p>
<blockquote>
<p><strong>可以根据标签的属性值、下标等来获取特定的节点</strong></p>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th>路径表达式</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>//title[@lang=”eng”]</td>
<td>选择lang属性值为eng的所有title元素</td>
</tr>
<tr>
<td>/bookstore/book[1]</td>
<td>选取属于 bookstore 子元素的第一个 book 元素</td>
</tr>
<tr>
<td>/bookstore/book[last()]</td>
<td>选取属于 bookstore 子元素的最后一个 book 元素</td>
</tr>
<tr>
<td>/bookstore/book[last()-1]</td>
<td>选取属于 bookstore 子元素的倒数第二个 book 元素</td>
</tr>
<tr>
<td>/bookstore/book[position()&gt;1]</td>
<td>选择bookstore下面的book元素，从第二个开始选择</td>
</tr>
<tr>
<td>//book/title[text()=’Harry Potter’]</td>
<td>选择所有book下的title元素，仅仅选择文本为Harry Potter的title元素</td>
</tr>
<tr>
<td>/bookstore/book[price&gt;35.00]/title</td>
<td>选取 bookstore 元素中的 book 元素的所有 title 元素，且其中的 price 元素的值须大于 35.00</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>在xpath中，第一个元素的位置是1</li>
<li>最后一个元素的位置是last()</li>
<li>倒数第二个是last()-1</li>
</ul>
<p>语法练习，从itcast的页面中，选择所有学科的名称、第一个学科的链接、最后一个学科的链接：<a target="_blank" rel="noopener" href="http://www.itcast.cn/">http://www.itcast.cn/</a></p>
<ul>
<li>所有的学科的名称：<code>//div[@class=&quot;nav_txt&quot;]//a[@class=&quot;a_gd&quot;]</code></li>
<li>第一个学科的链接：<code>//div[@class=&quot;nav_txt&quot;]/ul/li[1]/a/@href</code></li>
<li>最后一个学科的链接：<code>//div[@class=&quot;nav_txt&quot;]/ul/li[last()]/a/@href</code></li>
</ul>
<p><strong>3、xpath语法-其他常用节点选择语法</strong></p>
<blockquote>
<p>可以通过<strong>通配符</strong>来选取未知的html、xml的元素</p>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th>通配符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>*</td>
<td>匹配任何元素节点</td>
</tr>
<tr>
<td>@*</td>
<td>匹配任何属性节点</td>
</tr>
<tr>
<td>node()</td>
<td>匹配任何类型的节点</td>
</tr>
</tbody>
</table>
</div>
<p>语法练习，从itcast的页面中 <a target="_blank" rel="noopener" href="http://www.itcast.cn/">http://www.itcast.cn/</a> ，选中全部的标签、全部的属性</p>
<ul>
<li>全部的标签：<code>//*</code></li>
<li>全部的属性：<code>//@*</code></li>
</ul>
<p><strong>通过子节点的值修饰节点</strong>：</p>
<ul>
<li>子节点i的值&gt;2000的span节点：<code>//span[i&gt;2000]</code></li>
<li>第二个span子节点的值&gt;=9.4的div节点：<code>//div[span[2]&gt;=9.4]</code></li>
</ul>
<p><strong>通过包含修饰</strong>：</p>
<ul>
<li>id属性包含“qiushi_tag_”的div节点：<code>//div[contains(@id, &quot;qiushi_tag_&quot;)]</code></li>
<li>值包含“一页”的span节点：<code>//span[contains(text(), &quot;一页&quot;)]</code></li>
</ul>
<p><strong>复合语法：</strong></p>
<ul>
<li><code>/h/a|/h/span</code></li>
</ul>
<h3 id="lxml模块"><a href="#lxml模块" class="headerlink" title="lxml模块"></a>lxml模块</h3><p>安装lxml模块：<code>pip install lxml -i https://pypi.tuna.tsinghua.edu.cn/simple</code></p>
<h4 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h4><ol>
<li><p>导入lxml 的 etree 库：<code>from lxml import etree</code></p>
</li>
<li><p>利用etree.HTML，将html字符串（bytes类型或str类型）转化为Element对象，Element对象具有xpath的方法，配合xpath表达式来完成对数据的提取，返回结果的列表</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">html = etree.HTML(text) </span><br><span class="line">ret_list = html.xpath(<span class="string">&quot;xpath语法规则字符串&quot;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>xpath方法返回列表的三种情况</p>
<ul>
<li>返回空列表：根据xpath语法规则字符串，没有定位到任何元素</li>
<li>返回由字符串构成的列表：xpath字符串规则匹配的一定是文本内容或某属性的值</li>
<li>返回由Element对象构成的列表：xpath规则字符串匹配的是标签，列表中的Element对象可以继续进行xpath</li>
</ul>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">属性定位：</span><br><span class="line">    <span class="comment">#找到class属性值为song的div标签</span></span><br><span class="line">    //div[@<span class="class"><span class="keyword">class</span>=&quot;<span class="title">song</span>&quot;] </span></span><br><span class="line"><span class="class">层级&amp;索引定位：</span></span><br><span class="line"><span class="class">    #找到<span class="title">class</span>属性值为<span class="title">tang</span>的<span class="title">div</span>的直系子标签<span class="title">ul</span>下的第二个子标签<span class="title">li</span>下的直系子标签<span class="title">a</span></span></span><br><span class="line"><span class="class">    //<span class="title">div</span>[@<span class="title">class</span>=&quot;<span class="title">tang</span>&quot;]/<span class="title">ul</span>/<span class="title">li</span>[2]/<span class="title">a</span></span></span><br><span class="line"><span class="class">逻辑运算：</span></span><br><span class="line"><span class="class">    #找到<span class="title">href</span>属性值为空且<span class="title">class</span>属性值为<span class="title">du</span>的<span class="title">a</span>标签</span></span><br><span class="line"><span class="class">    //<span class="title">a</span>[@<span class="title">href</span>=&quot;&quot; <span class="title">and</span> @<span class="title">class</span>=&quot;<span class="title">du</span>&quot;]</span></span><br><span class="line"><span class="class">模糊匹配：</span></span><br><span class="line"><span class="class">    //<span class="title">div</span>[<span class="title">contains</span>(<span class="params">@<span class="keyword">class</span>, <span class="string">&quot;ng&quot;</span></span>)]</span></span><br><span class="line"><span class="class">    //<span class="title">div</span>[<span class="title">starts</span>-<span class="title">with</span>(<span class="params">@<span class="keyword">class</span>, <span class="string">&quot;ta&quot;</span></span>)]</span></span><br><span class="line"><span class="class">取文本：</span></span><br><span class="line"><span class="class">    # /表示获取某个标签下的文本内容</span></span><br><span class="line"><span class="class">    # //表示获取某个标签下的文本内容和所有子标签下的文本内容</span></span><br><span class="line"><span class="class">    //<span class="title">div</span>[@<span class="title">class</span>=&quot;<span class="title">song</span>&quot;]/<span class="title">p</span>[1]/<span class="title">text</span>()</span></span><br><span class="line"><span class="class">    //<span class="title">div</span>[@<span class="title">class</span>=&quot;<span class="title">tang</span>&quot;]//<span class="title">text</span>()</span></span><br><span class="line"><span class="class">取属性：</span></span><br><span class="line"><span class="class">    //<span class="title">div</span>[@<span class="title">class</span>=&quot;<span class="title">tang</span>&quot;]//<span class="title">li</span>[2]/<span class="title">a</span>/@<span class="title">href</span></span></span><br></pre></td></tr></table></figure>
<h4 id="使用示例-1"><a href="#使用示例-1" class="headerlink" title="使用示例"></a>使用示例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">xml = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;book&gt;</span></span><br><span class="line"><span class="string">    &lt;id&gt;1&lt;/id&gt;</span></span><br><span class="line"><span class="string">    &lt;name&gt;野花遍地香&lt;/name&gt;</span></span><br><span class="line"><span class="string">    &lt;price&gt;1.23&lt;/price&gt;</span></span><br><span class="line"><span class="string">    &lt;nick&gt;臭豆腐&lt;/nick&gt;</span></span><br><span class="line"><span class="string">    &lt;author&gt;</span></span><br><span class="line"><span class="string">        &lt;nick id=&quot;10086&quot;&gt;周大强&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;nick id=&quot;10010&quot;&gt;周芷若&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;nick class=&quot;joy&quot;&gt;周杰伦&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;nick class=&quot;jolin&quot;&gt;蔡依林&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">            &lt;nick&gt;热热热热热1&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;span&gt;</span></span><br><span class="line"><span class="string">            &lt;nick&gt;热热热热热2&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;/span&gt;</span></span><br><span class="line"><span class="string">    &lt;/author&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;partner&gt;</span></span><br><span class="line"><span class="string">        &lt;nick id=&quot;ppc&quot;&gt;胖胖陈&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;nick id=&quot;ppbc&quot;&gt;胖胖不陈&lt;/nick&gt;</span></span><br><span class="line"><span class="string">    &lt;/partner&gt;</span></span><br><span class="line"><span class="string">&lt;/book&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">tree = etree.HTML(xml)</span><br><span class="line">result = tree.xpath(<span class="string">&quot;/book&quot;</span>)  <span class="comment"># /表示层级关系. 第一个/是根节点</span></span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line">result = tree.xpath(<span class="string">&quot;/book/name&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line">result = tree.xpath(<span class="string">&quot;/book/name/text()&quot;</span>)  <span class="comment"># text() 拿文本</span></span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line">result = tree.xpath(<span class="string">&quot;/book/author//nick/text()&quot;</span>)  <span class="comment"># // 后代</span></span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line">result = tree.xpath(<span class="string">&quot;/book/author/*/nick/text()&quot;</span>)  <span class="comment"># * 任意的节点. 通配符(会儿)</span></span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line">result = tree.xpath(<span class="string">&quot;/book//nick/text()&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># [&lt;Element book at 0x1ef1c91e2c0&gt;]</span></span><br><span class="line"><span class="comment"># [&lt;Element name at 0x1ef1c9c0e00&gt;]</span></span><br><span class="line"><span class="comment"># [&#x27;野花遍地香&#x27;]</span></span><br><span class="line"><span class="comment"># [&#x27;周大强&#x27;, &#x27;周芷若&#x27;, &#x27;周杰伦&#x27;, &#x27;蔡依林&#x27;, &#x27;热热热热热1&#x27;, &#x27;热热热热热2&#x27;]</span></span><br><span class="line"><span class="comment"># [&#x27;热热热热热1&#x27;, &#x27;热热热热热2&#x27;]</span></span><br><span class="line"><span class="comment"># [&#x27;臭豆腐&#x27;, &#x27;周大强&#x27;, &#x27;周芷若&#x27;, &#x27;周杰伦&#x27;, &#x27;蔡依林&#x27;, &#x27;热热热热热1&#x27;, &#x27;热热热热热2&#x27;, &#x27;胖胖陈&#x27;, &#x27;胖胖不陈&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>注意：xpath路径中不能有tbody</p>
<h4 id="etree-tostring"><a href="#etree-tostring" class="headerlink" title="etree.tostring"></a>etree.tostring</h4><blockquote>
<p>运行下边的代码，观察对比html的原字符串和打印输出的结果</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">html_str = <span class="string">&#x27;&#x27;&#x27; &lt;div&gt; &lt;ul&gt; </span></span><br><span class="line"><span class="string">        &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link1.html&quot;&gt;first item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;li class=&quot;item-inactive&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;third item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt; </span></span><br><span class="line"><span class="string">        &lt;/ul&gt; &lt;/div&gt; &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">html = etree.HTML(html_str)</span><br><span class="line"></span><br><span class="line">handeled_html_str = etree.tostring(html).decode()</span><br><span class="line"><span class="built_in">print</span>(handeled_html_str)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span> <span class="tag">&lt;<span class="name">ul</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;item-1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;link1.html&quot;</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;item-1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;link2.html&quot;</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;item-inactive&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;link3.html&quot;</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;item-1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;link4.html&quot;</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;item-0&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;link5.html&quot;</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span> <span class="tag">&lt;/<span class="name">div</span>&gt;</span> <span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>结论</strong>：</p>
<ul>
<li>lxml.etree.HTML(html_str)可以自动补全标签</li>
<li><code>lxml.etree.tostring</code>函数可以将转换为Element对象再转换回html字符串</li>
<li>爬虫如果使用lxml来提取数据，应该以<code>lxml.etree.tostring</code>的返回结果作为提取数据的依据</li>
</ul>
<h3 id="selenium"><a href="#selenium" class="headerlink" title="selenium"></a>selenium</h3><p>官方文档：<a target="_blank" rel="noopener" href="http://www.selenium.org.cn/1598.html"><a target="_blank" rel="noopener" href="http://www.selenium.org.cn/category/use">使用说明 | selenium中文网</a></a></p>
<blockquote>
<p>Selenium是一个Web的自动化测试工具，最初是为网站自动化测试而开发的，Selenium 可以直接调用浏览器，它支持所有主流的浏览器（包括PhantomJS这些无界面的浏览器），可以接收指令，让浏览器自动加载页面，获取需要的数据，甚至页面截屏等。</p>
</blockquote>
<h4 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h4><p>1、在python虚拟环境中安装selenium模块：<code>pip/pip3 install selenium</code></p>
<p>2、下载浏览器驱动webdriver：以谷歌浏览器为例 <a target="_blank" rel="noopener" href="http://chromedriver.storage.googleapis.com/index.html">chromedriver.storage.googleapis.com/index.html</a></p>
<ol>
<li><p>查看浏览器内核版本</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img//image-20220119114803419.png" alt="image-20220119114803419" style="zoom: 67%;" /></p>
</li>
<li><p>查看网站对应的版本，如果没有刚好对应的，向前查找最近的版本</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img//image-20220119115053658.png" alt="image-20220119115053658" style="zoom: 67%;" /></p>
</li>
</ol>
<ol>
<li><p>下载操作系统对应的压缩包，查看<code>notes.txt</code>可以帮助选择版本</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img//image-20220119115001266.png" alt="image-20220119115001266" style="zoom: 50%;" /></p>
</li>
<li><p>解压后将 <code>chromedriver.exe</code> 文件放在已添加到环境变量的路径下，比如<code>python</code>环境所在的文件夹</p>
</li>
</ol>
<h4 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h4><p>利用浏览器原生的API，封装成一套更加面向对象的Selenium WebDriver API，直接操作浏览器页面里的元素，甚至操作浏览器本身（截屏，窗口大小，启动，关闭，安装插件，配置证书之类的）</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/selenium的工作原理.png" alt="selenium的工作原理"></p>
<ul>
<li>webdriver本质是一个web-server，对外提供webapi，其中封装了浏览器的各种功能</li>
<li>不同的浏览器使用各自不同的webdriver</li>
</ul>
<h4 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h4><blockquote>
<p>在下载好chromedriver以及安装好selenium模块后，执行下列代码并观察运行的过程</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果driver没有添加到了环境变量，则需要将driver的绝对路径赋值给executable_path参数</span></span><br><span class="line"><span class="comment"># driver = webdriver.Chrome(executable_path=&#x27;/home/worker/Desktop/driver/chromedriver&#x27;)</span></span><br><span class="line"><span class="comment"># 如果driver添加了环境变量则不需要设置executable_path</span></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 控制浏览器访问url地址</span></span><br><span class="line">driver.get(<span class="string">&quot;https://www.baidu.com/&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在百度搜索框中搜索&#x27;python&#x27;</span></span><br><span class="line">driver.find_element_by_id(<span class="string">&#x27;kw&#x27;</span>).send_keys(<span class="string">&#x27;python&#x27;</span>)</span><br><span class="line"><span class="comment"># 点击&#x27;百度搜索&#x27;</span></span><br><span class="line">driver.find_element_by_id(<span class="string">&#x27;su&#x27;</span>).click()</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">6</span>) <span class="comment"># 等待浏览器反应</span></span><br><span class="line"><span class="comment"># 退出浏览器</span></span><br><span class="line">driver.quit()  <span class="comment"># 一定要退出！不退出会有残留进程！</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>webdriver.Chrome(executable_path=&#39;./chromedriver&#39;)</code>中executable参数指定的是下载好的chromedriver文件的路径</li>
<li><code>driver.find_element_by_id(&#39;kw&#39;).send_keys(&#39;python&#39;)</code>定位id属性值是’kw’的标签，并向其中输入字符串’python’</li>
<li><code>driver.find_element_by_id(&#39;su&#39;).click()</code>定位id属性值是su的标签，并点击<ul>
<li>click函数作用是：触发标签的js的click事件</li>
</ul>
</li>
</ul>
<p>注意事项：</p>
<ol>
<li><p>谷歌浏览器装在D盘，程序报错没找到</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> Chrome</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"></span><br><span class="line">option = Options()</span><br><span class="line">option.binary_location = <span class="string">r&#x27;D:\Program Files\Google\Chrome\Application\chrome.exe&#x27;</span>  <span class="comment"># 指定谷歌浏览器的路径</span></span><br><span class="line"><span class="comment"># 创建一个浏览器对象</span></span><br><span class="line">driver = Chrome(options=option)</span><br></pre></td></tr></table></figure>
</li>
<li><p>浏览器加载需要时间，有时候浏览器没加载完成程序执行到下一步没找到元素会报错，可以加上 <code>sleep()</code>等几秒</p>
</li>
<li><p>浏览器最大化    <code>bro.maximize_window()</code></p>
</li>
</ol>
<h4 id="提取数据"><a href="#提取数据" class="headerlink" title="提取数据"></a>提取数据</h4><h5 id="driver对象"><a href="#driver对象" class="headerlink" title="driver对象"></a>driver对象</h5><blockquote>
<p>在使用selenium过程中，实例化driver对象后，driver对象有一些常用的属性和方法</p>
</blockquote>
<ol>
<li><code>driver.page_source</code> 当前标签页浏览器渲染之后的网页源代码</li>
<li><code>driver.current_url</code> 当前标签页的url</li>
<li><code>driver.close()</code> 关闭当前标签页，如果只有一个标签页则关闭整个浏览器</li>
<li><code>driver.quit()</code> 关闭浏览器</li>
<li><code>driver.forward()</code> 页面前进</li>
<li><code>driver.back()</code> 页面后退</li>
<li><code>driver.screen_shot(img_name)</code> 页面截图</li>
</ol>
<h5 id="获取标签元素"><a href="#获取标签元素" class="headerlink" title="获取标签元素"></a>获取标签元素</h5><blockquote>
<p>在selenium中可以通过多种方式来定位标签，返回标签元素对象</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">find_element_by_id                         (返回一个元素)</span><br><span class="line">find_element(s)_by_class_name             (根据类名获取元素列表)</span><br><span class="line">find_element(s)_by_name                   (根据标签的name属性值返回包含标签对象元素的列表)</span><br><span class="line">find_element(s)_by_xpath                  (返回一个包含元素的列表)</span><br><span class="line">find_element(s)_by_link_text              (根据连接文本获取元素列表)</span><br><span class="line">find_element(s)_by_partial_link_text      (根据链接包含的文本获取元素列表)</span><br><span class="line">find_element(s)_by_tag_name               (根据标签名获取元素列表)</span><br><span class="line">find_element(s)_by_css_selector           (根据css选择器来获取元素列表)</span><br></pre></td></tr></table></figure>
<ul>
<li>find_element和find_elements的区别：<ul>
<li>多了个s就返回列表，没有s就返回匹配到的第一个标签对象</li>
<li>find_element匹配不到就抛出异常，find_elements匹配不到就返回空列表</li>
</ul>
</li>
<li>by_link_text和by_partial_link_tex的区别：全部文本和包含某个文本</li>
<li>以上函数的使用方法：<code>driver.find_element_by_id(&#39;id_str&#39;)</code></li>
</ul>
<p><strong>标签对象提取文本内容和属性值</strong>：</p>
<blockquote>
<p>find_element仅仅能够获取元素，不能够直接获取其中的数据，如果需要获取数据需要使用以下方法</p>
</blockquote>
<ul>
<li>对元素执行点击操作<code>element.click()</code>，对定位到的标签对象进行点击操作</li>
<li>向输入框输入数据<code>element.send_keys(data)</code>，对定位到的标签对象输入数据</li>
<li>获取文本<code>element.text</code>，通过定位获取的标签对象的<code>text</code>属性，获取文本内容</li>
<li>获取属性值<code>element.get_attribute(&quot;属性名&quot;)</code>，通过定位获取的标签对象的<code>get_attribute</code>函数，传入属性名，来获取属性的值</li>
</ul>
<p>示例代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(<span class="string">&#x27;http://www.itcast.cn/&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ret = driver.find_elements_by_tag_name(<span class="string">&#x27;h2&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(ret[<span class="number">0</span>].text) <span class="comment"># </span></span><br><span class="line"></span><br><span class="line">ret = driver.find_elements_by_link_text(<span class="string">&#x27;黑马程序员&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(ret[<span class="number">0</span>].get_attribute(<span class="string">&#x27;href&#x27;</span>))</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
<h4 id="其他使用方法"><a href="#其他使用方法" class="headerlink" title="其他使用方法"></a>其他使用方法</h4><h5 id="切换标签页"><a href="#切换标签页" class="headerlink" title="切换标签页"></a>切换标签页</h5><blockquote>
<p>当selenium控制浏览器打开多个标签页时，如何控制浏览器在不同的标签页中进行切换呢？需要我们做以下两步：</p>
</blockquote>
<ul>
<li>获取所有标签页的窗口句柄</li>
<li>利用窗口句柄字切换到句柄指向的标签页</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 获取当前所有的标签页的句柄构成的列表</span></span><br><span class="line">current_windows = driver.window_handles</span><br><span class="line"><span class="comment"># 2. 根据标签页句柄列表索引下标进行切换</span></span><br><span class="line">driver.switch_to.window(current_windows[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<p>代码示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> Chrome</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">web = Chrome()</span><br><span class="line">web.get(<span class="string">&quot;http://lagou.com&quot;</span>)</span><br><span class="line"></span><br><span class="line">web.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;cboxClose&quot;]&#x27;</span>).click()</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">web.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;search_input&quot;]&#x27;</span>).send_keys(<span class="string">&quot;python&quot;</span>, Keys.ENTER)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">web.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;jobList&quot;]/div[1]/div[1]/div[1]/div[1]/div[1]/a&#x27;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如何进入到进窗口中进行提取</span></span><br><span class="line"><span class="comment"># 注意, 在selenium的眼中. 新窗口默认是不切换过来的.</span></span><br><span class="line">web.switch_to.window(web.window_handles[-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在新窗口中提取内容</span></span><br><span class="line">job_detail = web.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;job_detail&quot;]/dd[2]/div&#x27;</span>).text</span><br><span class="line"><span class="built_in">print</span>(job_detail)</span><br><span class="line"></span><br><span class="line">web.close() <span class="comment"># 关掉子窗口</span></span><br><span class="line"><span class="comment"># 变更selenium的窗口视角. 回到原来的窗口中</span></span><br><span class="line">web.switch_to.window(web.window_handles[<span class="number">0</span>])</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(web.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;jobList&quot;]/div[1]/div[1]/div[1]/div[1]/div[1]/a&#x27;</span>).text)</span><br></pre></td></tr></table></figure>
<h5 id="动作链和切换iframe"><a href="#动作链和切换iframe" class="headerlink" title="动作链和切换iframe"></a>动作链和切换iframe</h5><blockquote>
<h5 id="iframe是html中常用的一种技术，即一个页面中嵌套了另一个网页，selenium默认是访问不了frame中的内容的，对应的解决思路是driver-switch-to-frame-frame-element-。接下来我们通过qq邮箱模拟登陆来学习这个知识点"><a href="#iframe是html中常用的一种技术，即一个页面中嵌套了另一个网页，selenium默认是访问不了frame中的内容的，对应的解决思路是driver-switch-to-frame-frame-element-。接下来我们通过qq邮箱模拟登陆来学习这个知识点" class="headerlink" title="iframe是html中常用的一种技术，即一个页面中嵌套了另一个网页，selenium默认是访问不了frame中的内容的，对应的解决思路是driver.switch_to.frame(frame_element)。接下来我们通过qq邮箱模拟登陆来学习这个知识点"></a>iframe是html中常用的一种技术，即一个页面中嵌套了另一个网页，selenium默认是访问不了frame中的内容的，对应的解决思路是<code>driver.switch_to.frame(frame_element)</code>。接下来我们通过qq邮箱模拟登陆来学习这个知识点</h5></blockquote>
<p>参考代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="comment"># 导入动作链对应的类</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line">bro = webdriver.Chrome()</span><br><span class="line">bro.get(<span class="string">&#x27;https://www.runoob.com/try/try.php?filename=jqueryui-api-droppable&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果定位的标签是存在于iframe标签之中的则必须通过如下操作在进行标签定位</span></span><br><span class="line">iframe = bro.find_element_by_id(<span class="string">&quot;iframeResult&quot;</span>)</span><br><span class="line">bro.switch_to.frame(iframe)  <span class="comment"># 切换浏览器标签定位的作用域</span></span><br><span class="line">div = bro.find_element_by_id(<span class="string">&#x27;draggable&#x27;</span>)  <span class="comment"># 定位元素</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 动作链</span></span><br><span class="line">action = ActionChains(bro)</span><br><span class="line"><span class="comment"># 点击长按指定的标签</span></span><br><span class="line">action.click_and_hold(div)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    <span class="comment"># perform()立即执行动作链操作</span></span><br><span class="line">    <span class="comment"># move_by_offset(x,y):x水平方向 y竖直方向</span></span><br><span class="line">    action.move_by_offset(<span class="number">20</span>, <span class="number">0</span>).perform()</span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 释放动作链</span></span><br><span class="line">action.release()</span><br><span class="line">bro.switch_to.default_content()  <span class="comment"># 切换回原页面</span></span><br><span class="line">bro.find_element_by_xpath(<span class="string">&quot;/html/body/header/div/div[2]/form/input&quot;</span>).send_keys(<span class="string">&quot;python&quot;</span>)</span><br><span class="line">bro.quit()</span><br></pre></td></tr></table></figure>
<h5 id="处理cookie"><a href="#处理cookie" class="headerlink" title="处理cookie"></a>处理cookie</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_58204947/article/details/124836970">selenium携带cookies启动，请求_IT周星驰的博客-CSDN博客_selenium带cookie访问</a> </p>
<p>1、获取cookie</p>
<blockquote>
<p><code>driver.get_cookies()</code>返回列表，其中包含的是完整的cookie信息！不光有name、value，还有domain等cookie其他维度的信息。所以如果想要把获取的cookie信息和requests模块配合使用的话，需要转换为name、value作为键值对的cookie字典</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取当前标签页的全部cookie信息</span></span><br><span class="line"><span class="built_in">print</span>(driver.get_cookies())</span><br><span class="line"><span class="comment"># 把cookie转化为字典</span></span><br><span class="line">cookies_dict = &#123;cookie[<span class="string">&#x27;name&#x27;</span>]: cookie[<span class="string">&#x27;value&#x27;</span>] <span class="keyword">for</span> cookie <span class="keyword">in</span> driver.get_cookies()&#125;</span><br></pre></td></tr></table></figure>
<p>2、删除cookie</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除一条cookie</span></span><br><span class="line">driver.delete_cookie(<span class="string">&quot;CookieName&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除所有的cookie</span></span><br><span class="line">driver.delete_all_cookies()</span><br></pre></td></tr></table></figure>
<h5 id="执行js代码"><a href="#执行js代码" class="headerlink" title="执行js代码"></a>执行js代码</h5><p>执行js的方法：<code>driver.execute_script(js)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(<span class="string">&quot;http://www.itcast.cn/&quot;</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">js = <span class="string">&#x27;window.scrollTo(0,document.body.scrollHeight)&#x27;</span> <span class="comment"># js语句</span></span><br><span class="line">driver.execute_script(js) <span class="comment"># 执行js的方法</span></span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
<h5 id="页面等待"><a href="#页面等待" class="headerlink" title="页面等待"></a>页面等待</h5><p>1、强制等待：<code>time.sleep()</code></p>
<ul>
<li>设置的时间太短，元素还没有加载出来；设置的时间太长，则会浪费时间</li>
</ul>
<p>2、隐式等待</p>
<ul>
<li><p>隐式等待针对的是元素定位，隐式等待设置了一个时间，在一段时间内判断元素是否定位成功，如果完成了，就进行下一步</p>
</li>
<li><p>在设置的时间内没有定位成功，则会报超时加载</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()  </span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>) <span class="comment"># 隐式等待，最长等20秒  </span></span><br><span class="line">driver.get(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line">driver.find_element_by_xpath()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>3、显式等待</p>
<ul>
<li><p>每经过多少秒就查看一次等待条件是否达成，如果达成就停止等待，继续执行后续代码，如果没有达成就继续等待直到超过规定的时间后，报超时异常</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait  </span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC  </span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By </span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显式等待</span></span><br><span class="line">WebDriverWait(driver, <span class="number">20</span>, <span class="number">0.5</span>).until(EC.presence_of_element_located((By.LINK_TEXT, <span class="string">&#x27;好123&#x27;</span>)))  </span><br><span class="line"><span class="comment"># 参数20表示最长等待20秒</span></span><br><span class="line"><span class="comment"># 参数0.5表示0.5秒检查一次规定的标签是否存在</span></span><br><span class="line"><span class="comment"># EC.presence_of_element_located((By.LINK_TEXT, &#x27;好123&#x27;)) 表示通过链接文本内容定位标签</span></span><br><span class="line"><span class="comment"># 每0.5秒一次检查，通过链接文本内容定位标签是否存在，如果存在就向下继续执行；如果不存在，直到20秒上限就抛出异常</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(driver.find_element_by_link_text(<span class="string">&#x27;好123&#x27;</span>).get_attribute(<span class="string">&#x27;href&#x27;</span>))</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="无头浏览器"><a href="#无头浏览器" class="headerlink" title="无头浏览器"></a>无头浏览器</h5><blockquote>
<p>绝大多数服务器是没有界面的，selenium控制谷歌浏览器也是存在无界面模式的。</p>
</blockquote>
<p>开启无界面模式的方法：</p>
<ul>
<li>实例化配置对象：<code>chromeOpt = webdriver.ChromeOptions()</code></li>
<li>配置对象添加开启无界面模式的命令：<code>chromeOpt.add_argument(&quot;--headless&quot;)</code></li>
<li>配置对象添加禁用gpu的命令：<code>chromeOpt.add_argument(&quot;--disable-gpu&quot;)</code></li>
<li>实例化带有配置对象的driver对象：<code>driver = webdriver.Chrome(chrome_options=chromeOpt)</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> Chrome</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">opt = Options()</span><br><span class="line">opt.add_argument(<span class="string">&quot;--headless&quot;</span>)</span><br><span class="line">opt.add_argument(<span class="string">&quot;--disbale-gpu&quot;</span>)</span><br><span class="line"></span><br><span class="line">web = Chrome(options=opt)  <span class="comment"># 把参数配置设置到浏览器中</span></span><br><span class="line">web.get(<span class="string">&quot;https://www.endata.com.cn/BoxOffice/BO/Year/index.html&quot;</span>)</span><br><span class="line">sleep(<span class="number">1</span>) <span class="comment"># 等待一秒</span></span><br><span class="line"><span class="built_in">print</span>(web.page_source) <span class="comment"># 拿到页面代码Elements(经过数据加载以及js执行之后的结果的html内容)</span></span><br></pre></td></tr></table></figure>
<p>无头浏览器与有头浏览器的使用场景：</p>
<ul>
<li>通常在开发过程中我们需要查看运行过程中的各种情况所以通常使用有头浏览器</li>
<li>在项目完成进行部署的时候，通常平台采用的系统都是服务器版的操作系统，服务器版的操作系统必须使用无头浏览器才能正常运行</li>
</ul>
<p><strong>PhantomJS 是一个基于Webkit的“无界面”(headless)浏览器，它会把网站加载到内存并执行页面上的 JavaScript</strong>。下载地址：<a target="_blank" rel="noopener" href="http://phantomjs.org/download.html">http://phantomjs.org/download.html</a></p>
<h5 id="使用代理和UA"><a href="#使用代理和UA" class="headerlink" title="使用代理和UA"></a>使用代理和UA</h5><p>使用代理ip和替换UA的方法</p>
<ul>
<li>实例化配置对象：<code>chromeOpt = webdriver.ChromeOptions()</code></li>
<li><strong>配置对象添加使用代理ip的命令</strong>：<code>chromeOpt.add_argument(&#39;--proxy-server=http://202.20.16.82:9527&#39;)</code></li>
<li><strong>配置对象添加替换UA的命令</strong>：<code>chromeOpt.add_argument(&#39;--user-agent=Mozilla/5.0 HAHA&#39;)</code></li>
<li>实例化带有配置对象的driver对象：<code>driver = webdriver.Chrome(chrome_options=chromeOpt)</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">options = webdriver.ChromeOptions() <span class="comment"># 创建一个配置对象</span></span><br><span class="line">options.add_argument(<span class="string">&#x27;--proxy-server=http://202.20.16.82:9527&#x27;</span>) <span class="comment"># 使用代理ip</span></span><br><span class="line">options.add_argument(<span class="string">&#x27;--user-agent=Mozilla/5.0 HAHA&#x27;</span>) <span class="comment"># 替换User-Agent</span></span><br><span class="line">driver = webdriver.Chrome(chrome_options=options) <span class="comment"># 实例化带有配置的driver对象</span></span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">&#x27;http://www.itcast.cn&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(driver.title)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
<h5 id="规避检测"><a href="#规避检测" class="headerlink" title="规避检测"></a>规避检测</h5><p>浏览器抓包工具的控制台，输入<code>window.navigator.webdriver</code>，正常浏览器显示<code>false</code>，自动化打开的浏览器显示<code>true</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> Chrome</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"></span><br><span class="line">option = Options()</span><br><span class="line">options.add_experimental_option(<span class="string">&#x27;excludeSwitches&#x27;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>])  <span class="comment"># 使用开发者模式</span></span><br><span class="line">option.add_argument(<span class="string">&#x27;--disable-blink-features=AutomationControlled&#x27;</span>)  <span class="comment"># 禁用启用Blink运行时的功能</span></span><br><span class="line">web = Chrome(options=option)</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/image-20230104003502278.png" alt="image-20230104003502278" style="zoom: 80%;" /></p>
<h4 id="Linux部署"><a href="#Linux部署" class="headerlink" title="Linux部署"></a>Linux部署</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44617651/article/details/127003499">linux系统下如何部署selenium爬虫程序_q56731523的博客-CSDN博客_linux使用selenium</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/weifeng1463/p/10439178.html">CentOS 7 使用 Yum 软件源安装谷歌 Chrome 浏览器 - Oops!# - 博客园 (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_41191813/article/details/110390186"> Linux(红帽，centos)安装谷歌浏览器（google-chrom）_玻璃酸钠滴眼液的博客-CSDN博客_红帽安装谷歌浏览器</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44929594/article/details/122513925">Chrome浏览器的options参数_哈齐先生的博客-CSDN博客_chrome浏览器的options参数</a></p>
<h3 id="爬虫和反爬"><a href="#爬虫和反爬" class="headerlink" title="爬虫和反爬"></a>爬虫和反爬</h3><p><strong>反爬原因</strong>：</p>
<ol>
<li><p>爬虫占总PV(PV是指页面的访问次数，每打开或刷新一次页面，就算做一个pv)比例较高，这样浪费钱（尤其是三月份爬虫）。</p>
</li>
<li><p>公司可免费查询的资源被批量抓走，丧失竞争力，这样少赚钱。</p>
<blockquote>
<p>数据可以在非登录状态下直接被查询。如果强制登陆，那么可以通过封杀账号的方式让对方付出代价，这也是很多网站的做法。但是不强制对方登录。那么如果没有反爬虫，对方就可以批量复制的信息，公司竞争力就会大大减少。竞争对手可以抓到数据，时间长了用户就会知道，只需要去竞争对手那里就可以了，没必要来我们网站，这对我们是不利的。</p>
</blockquote>
</li>
<li><p>状告爬虫成功的几率小</p>
</li>
</ol>
<p><strong>服务器常反什么样的爬虫</strong>：</p>
<ol>
<li><p>十分低级的应届毕业生</p>
</li>
<li><p>十分低级的创业小公司</p>
</li>
<li><p>不小心写错了没人去停止的失控小爬虫</p>
</li>
<li><p>不小心写错了没人去停止的失控小爬虫</p>
<blockquote>
<p>有些网站已经做了相应的反爬，但是爬虫依然孜孜不倦地爬取。什么意思呢？就是说，他们根本爬不到任何数据，除了httpcode是200以外，一切都是不对的，可是爬虫依然不停止这个很可能就是一些托管在某些服务器上的小爬虫，已经无人认领了，依然在辛勤地工作着。</p>
</blockquote>
</li>
<li><p>成型的商业对手</p>
</li>
<li>抽风的搜索引擎</li>
</ol>
<p><strong>反爬虫领域常见的一些概念</strong>：</p>
<ul>
<li>爬虫：使用任何技术手段，批量获取网站信息的一种方式。关键在于批量。</li>
<li>反爬虫：使用任何技术手段，阻止别人批量获取自己网站信息的一种方式。关键也在于批量。</li>
<li>误伤：在反爬虫的过程中，错误的将普通用户识别为爬虫。误伤率高的反爬虫策略，效果再好也不能用。</li>
<li>拦截：成功地阻止爬虫访问。这里会有拦截率的概念。通常来说，拦截率越高的反爬虫策略，误伤的可能性就越高。因此需要做个权衡。</li>
<li>资源：机器成本与人力成本的总和。</li>
</ul>
<h4 id="常见反爬手段"><a href="#常见反爬手段" class="headerlink" title="常见反爬手段"></a>常见反爬手段</h4><ul>
<li>基于身份识别进行反爬</li>
<li>基于爬虫行为进行反爬</li>
<li>基于数据加密进行反爬</li>
</ul>
<h5 id="基于身份识别"><a href="#基于身份识别" class="headerlink" title="基于身份识别"></a>基于身份识别</h5><p><strong>1 通过headers字段来反爬</strong></p>
<blockquote>
<p>headers中有很多字段，这些字段都有可能会被对方服务器拿过来进行判断是否为爬虫</p>
</blockquote>
<p>1.1 通过headers中的User-Agent字段来反爬</p>
<ul>
<li>反爬原理：爬虫默认情况下没有User-Agent，而是使用模块默认设置</li>
<li>解决方法：请求之前添加User-Agent即可；更好的方式是使用User-Agent池来解决（收集一堆User-Agent的方式，或者是随机生成User-Agent）</li>
</ul>
<p>1.2 通过referer字段或者是其他字段来反爬</p>
<ul>
<li>反爬原理：爬虫默认情况下不会带上referer字段，服务器端通过判断请求发起的源头，以此判断请求是否合法</li>
<li>解决方法：添加referer字段</li>
</ul>
<p>1.3 通过cookie来反爬</p>
<ul>
<li>反爬原因：通过检查cookies来查看发起请求的用户是否具备相应权限，以此来进行反爬</li>
<li>解决方案：进行模拟登陆，成功获取cookies之后在进行数据爬取</li>
</ul>
<p><strong>2 通过请求参数来反爬</strong></p>
<blockquote>
<p>请求参数的获取方法有很多，向服务器发送请求，很多时候需要携带请求参数，通常服务器端可以通过检查请求参数是否正确来判断是否为爬虫</p>
</blockquote>
<p>2.1 通过从html静态文件中获取请求数据(github登录数据)</p>
<ul>
<li>反爬原因：通过增加获取请求参数的难度进行反爬</li>
<li>解决方案：仔细分析抓包得到的每一个包，搞清楚请求之间的联系</li>
</ul>
<p>2.2 通过发送请求获取请求数据</p>
<ul>
<li>反爬原因：通过增加获取请求参数的难度进行反爬</li>
<li>解决方案：仔细分析抓包得到的每一个包，搞清楚请求之间的联系，搞清楚请求参数的来源</li>
</ul>
<p>2.3 通过js生成请求参数</p>
<ul>
<li>反爬原理：js生成了请求参数</li>
<li>解决方法：分析js，观察加密的实现过程，通过js2py获取js的执行结果，或者使用selenium来实现</li>
</ul>
<p>2.4 通过验证码来反爬</p>
<ul>
<li>反爬原理：对方服务器通过弹出验证码强制验证用户浏览行为</li>
<li>解决方法：打码平台或者是机器学习的方法识别验证码，其中打码平台廉价易用，更值得推荐</li>
</ul>
<h5 id="基于爬虫行为"><a href="#基于爬虫行为" class="headerlink" title="基于爬虫行为"></a>基于爬虫行为</h5><p><strong>1 基于请求频率或总请求数量</strong></p>
<blockquote>
<p>爬虫的行为与普通用户有着明显的区别，爬虫的请求频率与请求次数要远高于普通用户</p>
</blockquote>
<p>1.1 通过请求ip/账号单位时间内总请求数量进行反爬</p>
<ul>
<li>反爬原理：正常浏览器请求网站，速度不会太快，同一个ip/账号大量请求了对方服务器，有更大的可能性会被识别为爬虫</li>
<li>解决方法：对应的通过购买高质量的ip的方式能够解决问题/购买个多账号</li>
</ul>
<p>1.2 通过同一ip/账号请求之间的间隔进行反爬</p>
<ul>
<li>反爬原理：正常人操作浏览器浏览网站，请求之间的时间间隔是随机的，而爬虫前后两个请求之间时间间隔通常比较固定同时时间间隔较短，因此可以用来做反爬</li>
<li>解决方法：请求之间进行随机等待，模拟真实用户操作，在添加时间间隔后，为了能够高速获取数据，尽量使用代理池，如果是账号，则将账号请求之间设置随机休眠</li>
</ul>
<p>1.3 通过对请求ip/账号每天请求次数设置阈值进行反爬</p>
<ul>
<li>反爬原理：正常的浏览行为，其一天的请求次数是有限的，通常超过某一个值，服务器就会拒绝响应</li>
<li>解决方法：对应的通过购买高质量的ip的方法/多账号，同时设置请求间随机休眠</li>
</ul>
<p><strong>2 根据爬取行为进行反爬，通常在爬取步骤上做分析</strong></p>
<p>2.1 通过js实现跳转来反爬</p>
<ul>
<li>反爬原理：js实现页面跳转，无法在源码中获取下一页url</li>
<li>解决方法: 多次抓包获取条状url，分析规律</li>
</ul>
<p>2.2 通过蜜罐(陷阱)获取爬虫ip(或者代理ip)，进行反爬</p>
<ul>
<li>反爬原理：在爬虫获取链接进行请求的过程中，爬虫会根据正则，xpath，css等方式进行后续链接的提取，此时服务器端可以设置一个陷阱url，会被提取规则获取，但是正常用户无法获取，这样就能有效的区分爬虫和正常用户</li>
<li>解决方法: 完成爬虫的编写之后，使用代理批量爬取测试/仔细分析响应内容结构，找出页面中存在的陷阱</li>
</ul>
<p>2.3 通过假数据反爬</p>
<ul>
<li>反爬原理：向返回的响应中添加假数据污染数据库，通常假数据不会被正常用户看到</li>
<li>解决方法: 长期运行，核对数据库中数据同实际页面中数据对应情况，如果存在问题/仔细分析响应内容</li>
</ul>
<p>2.4 阻塞任务队列</p>
<ul>
<li>反爬原理：通过生成大量垃圾url，从而阻塞任务队列，降低爬虫的实际工作效率</li>
<li>解决方法: 观察运行过程中请求响应状态/仔细分析源码获取垃圾url生成规则，对URL进行过滤</li>
</ul>
<p>2.5 阻塞网络IO</p>
<ul>
<li>反爬原理：发送请求获取响应的过程实际上就是下载的过程，在任务队列中混入一个大文件的url，当爬虫在进行该请求时将会占用网络io，如果是有多线程则会占用线程</li>
<li>解决方法: 观察爬虫运行状态/多线程对请求线程计时/发送请求钱</li>
</ul>
<p>2.6 运维平台综合审计</p>
<ul>
<li>反爬原理：通过运维平台进行综合管理，通常采用复合型反爬虫策略，多种手段同时使用</li>
<li>解决方法: 仔细观察分析，长期运行测试目标网站，检查数据采集速度，多方面处理</li>
</ul>
<h5 id="基于数据加密"><a href="#基于数据加密" class="headerlink" title="基于数据加密"></a>基于数据加密</h5><p><strong>1 对响应中含有的数据进行特殊化处理</strong></p>
<blockquote>
<p>通常的特殊化处理主要指的就是css数据偏移/自定义字体/数据加密/数据图片/特殊编码格式等</p>
</blockquote>
<p>1.1 通过自定义字体来反爬 下图来自猫眼电影电脑版</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/使用字体来反爬.png" alt="img" style="zoom: 50%;" /></p>
<ul>
<li>反爬思路: 使用自有字体文件</li>
<li>解决思路：切换到手机版/解析字体文件进行翻译</li>
</ul>
<p>1.2 通过css来反爬 下图来自猫眼去哪儿电脑版</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/通过css反爬.png" alt="img" style="zoom:50%;" /></p>
<ul>
<li>反爬思路：源码数据不为真正数据，需要通过css位移才能产生真正数据</li>
<li>解决思路：计算css的偏移</li>
</ul>
<p>1.3 通过js动态生成数据进行反爬</p>
<ul>
<li>反爬原理：通过js动态生成</li>
<li>解决思路：解析关键js，获得数据生成流程，模拟生成数据</li>
</ul>
<p>1.4 通过数据图片化反爬</p>
<ul>
<li>58同城短租](<a target="_blank" rel="noopener" href="https://baise.58.com/duanzu/38018718834984x.shtml">https://baise.58.com/duanzu/38018718834984x.shtml</a>)</li>
<li>解决思路：通过使用图片解析引擎从图片中解析数据</li>
</ul>
<p>1.5 通过编码格式进行反爬</p>
<ul>
<li>反爬原理: 不适用默认编码格式，在获取响应之后通常爬虫使用utf-8格式进行解码，此时解码结果将会是乱码或者报错</li>
<li>解决思路：根据源码进行多格式解码，或者真正的解码格式</li>
</ul>
<h4 id="验证码处理"><a href="#验证码处理" class="headerlink" title="验证码处理"></a>验证码处理</h4><h5 id="图片验证码"><a href="#图片验证码" class="headerlink" title="图片验证码"></a>图片验证码</h5><p>1.1 什么是图片验证码</p>
<ul>
<li>验证码（CAPTCHA）是“Completely Automated Public Turing test to tell Computers and Humans Apart”（全自动区分计算机和人类的图灵测试）的缩写，是一种区分用户是计算机还是人的公共全自动程序。</li>
</ul>
<p>1.2 验证码的作用</p>
<ul>
<li>防止恶意破解密码、刷票、论坛灌水、刷页。有效防止某个黑客对某一个特定注册用户用特定程序暴力破解方式进行不断的登录尝试，实际上使用验证码是现在很多网站通行的方式（比如招商银行的网上个人银行，百度社区），我们利用比较简易的方式实现了这个功能。虽然登录麻烦一点，但是对网友的密码安全来说这个功能还是很有必要，也很重要。</li>
</ul>
<p>1.3 图片验证码在爬虫中的使用场景</p>
<ul>
<li>注册</li>
<li>登录</li>
<li>频繁发送请求时，服务器弹出验证码进行验证</li>
</ul>
<p>1.4 图片验证码的处理方案</p>
<ul>
<li>手动输入(input) 这种方法仅限于登录一次就可持续使用的情况</li>
<li>图像识别引擎解析 使用光学识别引擎处理图片中的数据，目前常用于图片数据提取，较少用于验证码处理</li>
<li>打码平台 爬虫常用的验证码解决方案</li>
</ul>
<h5 id="图片识别引擎"><a href="#图片识别引擎" class="headerlink" title="图片识别引擎"></a>图片识别引擎</h5><blockquote>
<p>OCR（Optical Character Recognition）是指使用扫描仪或数码相机对文本资料进行扫描成图像文件，然后对图像文件进行分析处理，自动识别获取文字信息及版面信息的软件。</p>
</blockquote>
<p>2.1 什么是tesseract</p>
<ul>
<li>Tesseract，一款由HP实验室开发由Google维护的开源OCR引擎，特点是开源，免费，支持多语言，多平台。</li>
<li>项目地址：<a target="_blank" rel="noopener" href="https://github.com/tesseract-ocr/tesseract">https://github.com/tesseract-ocr/tesseract</a></li>
</ul>
<p>2.2 图片识别引擎环境的安装</p>
<ol>
<li><p>引擎的安装</p>
<ul>
<li><p>mac环境下直接执行命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install --with-training-tools tesseract</span><br></pre></td></tr></table></figure>
</li>
<li><p>windows环境下的安装 可以通过exe安装包安装，下载地址可以从GitHub项目中的wiki找到。安装完成后记得将Tesseract 执行文件的目录加入到PATH中，方便后续调用。</p>
</li>
<li><p>linux环境下的安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install tesseract-ocr</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Python库的安装</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PIL用于打开图片文件</span></span><br><span class="line">pip/pip3 install pillow</span><br><span class="line"></span><br><span class="line"><span class="comment"># pytesseract模块用于从图片中解析数据</span></span><br><span class="line">pip/pip3 install pytesseract</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>2.3 图片识别引擎的使用</p>
<ul>
<li>通过pytesseract模块的 image_to_string 方法就能将打开的图片文件中的数据提取成字符串数据，具体方法如下</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> pytesseract</span><br><span class="line"></span><br><span class="line">im = Image.<span class="built_in">open</span>()</span><br><span class="line"></span><br><span class="line">result = pytesseract.image_to_string(im)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>
<p>2.4 图片识别引擎的使用扩展</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/cnlian/p/5765871.html">tesseract简单使用与训练</a></p>
</li>
<li><p>其他ocr平台</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">微软Azure 图像识别：https://azure.microsoft.com/zh-cn/services/cognitive-services/computer-vision/</span><br><span class="line">有道智云文字识别：http://aidemo.youdao.com/ocrdemo</span><br><span class="line">阿里云图文识别：https://www.aliyun.com/product/cdi/</span><br><span class="line">腾讯OCR文字识别：https://cloud.tencent.com/product/ocr</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="打码平台"><a href="#打码平台" class="headerlink" title="打码平台"></a>打码平台</h5><p><a target="_blank" rel="noopener" href="http://www.chaojiying.com/">超级鹰验证码识别-专业的验证码云端识别服务,让验证码识别更快速、更准确、更强大 (chaojiying.com)</a></p>
<p>常见的验证码的种类：</p>
<p><strong>1 url地址不变，验证码不变</strong></p>
<p>这是验证码里面非常简单的一种类型，对应的只需要获取验证码的地址，然后请求，通过打码平台识别即可</p>
<p><strong>2 url地址不变，验证码变化</strong></p>
<p>这种验证码的类型是更加常见的一种类型，对于这种验证码，大家需要思考：</p>
<blockquote>
<p>在登录的过程中，假设我输入的验证码是对的，对方服务器是如何判断当前我输入的验证码是显示在我屏幕上的验证码，而不是其他的验证码呢？</p>
</blockquote>
<p>在获取网页的时候，请求验证码，以及提交验证码的时候，对方服务器肯定通过了某种手段验证我之前获取的验证码和最后提交的验证码是同一个验证码，那这个手段是什么手段呢？</p>
<p>很明显，就是通过cookie来实现的，所以对应的，在请求页面，请求验证码，提交验证码的到时候需要保证cookie的一致性，对此可以使用requests.session来解决</p>
<h4 id="chrome浏览器"><a href="#chrome浏览器" class="headerlink" title="chrome浏览器"></a>chrome浏览器</h4><h5 id="新建隐身窗口"><a href="#新建隐身窗口" class="headerlink" title="新建隐身窗口"></a>新建隐身窗口</h5><blockquote>
<p>浏览器中直接打开网站，会自动带上之前网站时保存的cookie，但是在爬虫中首次获取页面是没有携带cookie的，这种情况如何解决呢？</p>
</blockquote>
<p>使用隐身窗口，首次打开网站，不会带上cookie，能够观察页面的获取情况，包括对方服务器如何设置cookie在本地</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/新建隐身窗口.png" alt="img" style="zoom:50%;" /></p>
<h5 id="network"><a href="#network" class="headerlink" title="network"></a>network</h5><p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/chrome中network更多用途.png" alt="img" style="zoom:50%;" /></p>
<p><strong>Perserve log</strong></p>
<p>默认情况下，页面发生跳转之后，之前的请求url地址等信息都会消失，勾选perserve log后之前的请求都会被保留</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/勾选perservelog的效果.png" alt="img" style="zoom:50%;" /></p>
<p><strong>filter过滤</strong></p>
<p>在url地址很多的时候，可以在filter中输入部分url地址，对所有的url地址起到一定的过滤效果，具体位置在上面第二幅图中的2的位置</p>
<p><strong>观察特定种类的请求</strong></p>
<p>在上面第二幅图中的3的位置，有很多选项，默认是选择的all，即会观察到所有种类的请求</p>
<p>很多时候处于自己的目的可以选择all右边的其他选项，比如常见的选项：</p>
<ul>
<li>XHR:大部分情况表示ajax请求</li>
<li>JS:js请求</li>
<li>CSS:css请求</li>
</ul>
<p>但是很多时候我们并不能保证我们需要的请求是什么类型，特别是我们不清楚一个请求是否为ajax请求的时候，直接选择<code>all</code>,从前往后观察即可，其中js，css，图片等不去观察即可</p>
<p>不要被浏览器中的一堆请求吓到了，这些请求中除了js，css，图片的请求外，其他的请求并没有多少个</p>
<h5 id="寻找登录接口"><a href="#寻找登录接口" class="headerlink" title="寻找登录接口"></a>寻找登录接口</h5><blockquote>
<p>回顾之前人人网的爬虫我们找到了一个登陆接口，那么这个接口从哪里找到的呢？<a target="_blank" rel="noopener" href="http://www.renren.com">http://www.renren.com</a></p>
</blockquote>
<p><strong>寻找action对应的url地址</strong></p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/人人网登录的地址.png" alt="img" style="zoom:50%;" /></p>
<p>可以发现，这个地址就是在登录的form表单中action对应的url地址，回顾前端的知识点，可以发现就是进行表单提交的地址，对应的，提交的数据，仅仅需要：<code>用户名的input标签中，name的值作为键，用户名作为值，密码的input标签中，name的值作为键，密码作为值即可</code></p>
<p><strong>思考</strong>：如果action对应的没有url地址的时候可以怎么做？</p>
<p><strong>通过抓包寻找登录的url地址</strong></p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/人人网抓包寻找url地址.png" alt="img" style="zoom:50%;" /></p>
<p>通过抓包可以发现，在这个url地址和请求体中均有参数，比如<code>uniqueTimestamp</code>和<code>rkey</code>以及加密之后的<code>password</code></p>
<p>这个时候我们可以观察手机版的登录接口，是否也是一样的</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/人人网手机版登录-16767034784476.png" alt="img" style="zoom:50%;" /></p>
<p>可以发现在手机版中，依然有参数，但是参数的个数少一些，这个时候，我们可以<strong>使用手机版作为参考，下一节来学习如何分析js</strong></p>
<h4 id="JS解析"><a href="#JS解析" class="headerlink" title="JS解析"></a>JS解析</h4><h5 id="确定js位置"><a href="#确定js位置" class="headerlink" title="确定js位置"></a>确定js位置</h5><blockquote>
<p>对于前面人人网的案例，我们知道了url地址中有部分参数，但是参数是如何生成的呢？</p>
</blockquote>
<p>毫无疑问，参数肯定是js生成的，那么如何获取这些参数的规律呢？通过下面的学习来了解</p>
<p>1、观察按钮的绑定js事件</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/js的绑定事件.png" alt="img" style="zoom:50%;" /></p>
<p>通过点击按钮，然后点击<code>Event Listener</code>，部分网站可以找到绑定的事件，对应的，只需要点击即可跳转到js的位置</p>
<p>2、通过search all file 来搜索</p>
<p>部分网站的按钮可能并没有绑定js事件监听，那么这个时候可以通过搜索请求中的关键字来找到js的位置，比如<code>livecell</code></p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/searchallfile搜索关键字.png" alt="img" style="zoom:50%;" /></p>
<p>点击美化输出选项</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/点击美化输出.png" alt="img" style="zoom: 33%;" /></p>
<p>可以继续在其中搜索关键字</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/继续在其中搜索关键字.png" alt="img" style="zoom:33%;" /></p>
<h5 id="观察js执行过程"><a href="#观察js执行过程" class="headerlink" title="观察js执行过程"></a>观察js执行过程</h5><p>找到js的位置之后，我们可以来通过观察js的位置，找到js具体在如何执行，后续我们可以通过python程序来模拟js的执行，或者是使用类似<code>js2py</code>直接把js代码转化为python程序去执行</p>
<p>观察js的执行过程最简单的方式是添加断点</p>
<p><img src="https://gitee.com/yanglinqi107/Images/raw/master/Python-img/添加断点.png" alt="img" style="zoom: 50%;" /></p>
<p>添加断点的方式：在左边行号点击即可添加，对应的右边BreakPoints中会出现现有的所有断点</p>
<p>添加断点之后继续点击登录，每次程序在断点位置都会停止，通过如果该行有变量产生，都会把变量的结果展示在Scoope中</p>
<p>在上图的右上角有1，2，3三个功能，分别表示：</p>
<ul>
<li>1：继续执行到下一个断点</li>
<li>2：进入调用的函数中</li>
<li>3：从调用的函数中跳出来</li>
</ul>
<h5 id="js2py的使用"><a href="#js2py的使用" class="headerlink" title="js2py的使用"></a>js2py的使用</h5><blockquote>
<p>在知道了js如何生成我们想要的数据之后，那么接下来我们就需要使用程序获取js执行之后的结果了</p>
</blockquote>
<p>js2py是一个js的翻译工具，也是一个通过纯python实现的js的解释器，<a target="_blank" rel="noopener" href="https://github.com/PiotrDabkowski/Js2Py">github上源码与示例</a></p>
<p>js的执行方式大致分为两种：</p>
<ol>
<li>在了解了js内容和执行顺序之后，通过python来完成js的执行过程，得到结果</li>
<li>在了解了js内容和执行顺序之后，使用类似js2py的模块来执js代码，得到结果</li>
</ol>
<p>但是在使用python程序实现js的执行时候，需要观察的js的每一个步骤，非常麻烦，所以更多的时候我们会选择使用类似js2py的模块去执行js，接下来我们来使用js2py实现人人网登录参数的获取</p>
<p><strong>具体的实现</strong></p>
<p>定位进行登录js代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">formSubmit: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> e, t = &#123;&#125;;</span><br><span class="line">        $(<span class="string">&quot;.login&quot;</span>).addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            t.phoneNum = $(<span class="string">&quot;.phonenum&quot;</span>).value,</span><br><span class="line">            t.password = $(<span class="string">&quot;.password&quot;</span>).value,</span><br><span class="line">            e = loginValidate(t),</span><br><span class="line">            t.c1 = c1 || <span class="number">0</span>,</span><br><span class="line">            e.flag ? ajaxFunc(<span class="string">&quot;get&quot;</span>, <span class="string">&quot;http://activity.renren.com/livecell/rKey&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> n = <span class="built_in">JSON</span>.parse(e).data;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0</span> == n.code) &#123;</span><br><span class="line">                    t.password = t.password.split(<span class="string">&quot;&quot;</span>).reverse().join(<span class="string">&quot;&quot;</span>),</span><br><span class="line">                    setMaxDigits(<span class="number">130</span>);</span><br><span class="line">                    <span class="keyword">var</span> o = <span class="keyword">new</span> RSAKeyPair(n.e,<span class="string">&quot;&quot;</span>,n.n)</span><br><span class="line">                      , r = encryptedString(o, t.password);</span><br><span class="line">                    t.password = r,</span><br><span class="line">                    t.rKey = n.rkey</span><br><span class="line">                &#125; <span class="keyword">else</span></span><br><span class="line">                    toast(<span class="string">&quot;公钥获取失败&quot;</span>),</span><br><span class="line">                    t.rKey = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                ajaxFunc(<span class="string">&quot;post&quot;</span>, <span class="string">&quot;http://activity.renren.com/livecell/ajax/clog&quot;</span>, t, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> e = <span class="built_in">JSON</span>.parse(e).logInfo;</span><br><span class="line">                    <span class="number">0</span> == e.code ? location.href = <span class="built_in">localStorage</span>.getItem(<span class="string">&quot;url&quot;</span>) || <span class="string">&quot;&quot;</span> : toast(e.msg || <span class="string">&quot;登录出错&quot;</span>)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;) : toast(e.msg)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>从代码中我们知道:</p>
<ol>
<li>我们要登录需要对密码进行加密和获取rkey字段的值</li>
<li>rkey字段的值我们直接发送请求rkey请求就可以获得</li>
<li>密码是先反转然后使用RSA进行加密, js代码很复杂, 我们希望能通过在python中执行js来实现</li>
</ol>
<p>实现思路:</p>
<ol>
<li><p>使用session发送rKey获取登录需要信息</p>
<ul>
<li>url: <a target="_blank" rel="noopener" href="http://activity.renren.com/livecell/rKey">http://activity.renren.com/livecell/rKey</a></li>
<li>方法: get</li>
</ul>
</li>
<li><p>根据获取信息对密码进行加密 </p>
<p>2.1 准备用户名和密码</p>
<p>2.2 使用js2py生成js的执行环境:context</p>
<p>2.3 拷贝使用到js文件的内容到本项目中</p>
<p>2.4 读取js文件的内容,使用context来执行它们</p>
<p>2.5 向context环境中添加需要数据</p>
<p>2.6 使用context执行加密密码的js字符串</p>
<p>2.7 通过context获取加密后密码信息</p>
</li>
<li><p>使用session发送登录请求</p>
<ul>
<li><p>URL: <a target="_blank" rel="noopener" href="http://activity.renren.com/livecell/ajax/clog">http://activity.renren.com/livecell/ajax/clog</a></p>
</li>
<li><p>请求方法: POST</p>
</li>
<li><p>数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">phoneNum: xxxxxxx</span><br><span class="line">password: (加密后生产的)</span><br><span class="line">c1: 0</span><br><span class="line">rKey: rkey请求获取的</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> js2py</span><br><span class="line"></span><br><span class="line"><span class="comment"># - 实现思路:</span></span><br><span class="line"><span class="comment">#   - 使用session发送rKey获取登录需要信息</span></span><br><span class="line"><span class="comment">#     - url: http://activity.renren.com/livecell/rKey</span></span><br><span class="line"><span class="comment">#     - 方法: get</span></span><br><span class="line"><span class="comment">#  获取session对象</span></span><br><span class="line">session = requests.session()</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Linux; Android 5.0; SM-G900P Build/LRX21T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.139 Mobile Safari/537.36&quot;</span>,</span><br><span class="line">    <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;application/x-www-form-urlencoded&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 设置session的请求头信息</span></span><br><span class="line">session.headers = headers</span><br><span class="line"></span><br><span class="line">response = session.get(<span class="string">&quot;http://activity.renren.com/livecell/rKey&quot;</span>)</span><br><span class="line"><span class="comment"># print(response.content.decode())</span></span><br><span class="line">n = json.loads(response.content)[<span class="string">&#x27;data&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#   - 根据获取信息对密码进行加密</span></span><br><span class="line"><span class="comment">#     - 准备用户名和密码</span></span><br><span class="line">phoneNum = <span class="string">&quot;131...&quot;</span></span><br><span class="line">password = <span class="string">&quot;****&quot;</span></span><br><span class="line"><span class="comment">#     - 使用js2py生成js的执行环境:context</span></span><br><span class="line">context = js2py.EvalJs()</span><br><span class="line"><span class="comment">#     - 拷贝使用到js文件的内容到本项目中</span></span><br><span class="line"><span class="comment">#     - 读取js文件的内容,使用context来执行它们</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;BigInt.js&quot;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    context.execute(f.read())</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;RSA.js&quot;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    context.execute(f.read())</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;Barrett.js&quot;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    context.execute(f.read())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># - 向context环境中添加需要数据</span></span><br><span class="line">context.t = &#123;<span class="string">&#x27;password&#x27;</span>: password&#125;</span><br><span class="line">context.n = n</span><br><span class="line"><span class="comment">#     - 执行加密密码的js字符</span></span><br><span class="line">js = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">       t.password = t.password.split(&quot;&quot;).reverse().join(&quot;&quot;),</span></span><br><span class="line"><span class="string">       setMaxDigits(130);</span></span><br><span class="line"><span class="string">       var o = new RSAKeyPair(n.e,&quot;&quot;,n.n)</span></span><br><span class="line"><span class="string">        , r = encryptedString(o, t.password);</span></span><br><span class="line"><span class="string">      &#x27;&#x27;&#x27;</span></span><br><span class="line">context.execute(js)</span><br><span class="line"><span class="comment"># - 通过context获取加密后密码信息</span></span><br><span class="line"><span class="comment"># print(context.r)</span></span><br><span class="line">password = context.r</span><br><span class="line"><span class="comment">#   - 使用session发送登录请求</span></span><br><span class="line"><span class="comment">#     - URL: http://activity.renren.com/livecell/ajax/clog</span></span><br><span class="line"><span class="comment">#     - 请求方法: POST</span></span><br><span class="line"><span class="comment">#     - 数据:</span></span><br><span class="line"><span class="comment">#       - phoneNum: 15565280933</span></span><br><span class="line"><span class="comment">#       - password: (加密后生产的)</span></span><br><span class="line"><span class="comment">#       - c1: 0</span></span><br><span class="line"><span class="comment">#       - rKey: rkey请求获取的</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;phoneNum&#x27;</span>: <span class="string">&#x27;131....&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: password,</span><br><span class="line">    <span class="string">&#x27;c1&#x27;</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="string">&#x27;rKey&#x27;</span>:n[<span class="string">&#x27;rkey&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(session.headers)</span></span><br><span class="line">response = session.post(<span class="string">&quot;http://activity.renren.com/livecell/ajax/clog&quot;</span>, data=data)</span><br><span class="line"><span class="built_in">print</span>(response.content.decode())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问登录的资源</span></span><br><span class="line">response = session.get(<span class="string">&quot;http://activity.renren.com/home#profile&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(response.content.decode())</span><br></pre></td></tr></table></figure>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><p>第三方模块加载js：js2py pyv8 executejs splash</p>
<p>布隆过滤器：url去重</p>
<p>文本内容去重：编辑距离，simhash</p>

    </div>

    
    
    
        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      
      
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80"><span class="nav-number">1.</span> <span class="nav-text">爬虫基础</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%88%AC%E8%99%AB%E6%A6%82%E8%BF%B0"><span class="nav-number">1.1.</span> <span class="nav-text">爬虫概述</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%88%AC%E8%99%AB%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-number">1.1.1.</span> <span class="nav-text">爬虫的概念</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%88%AC%E8%99%AB%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-number">1.1.2.</span> <span class="nav-text">爬虫的作用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%88%AC%E8%99%AB%E7%9A%84%E5%88%86%E7%B1%BB"><span class="nav-number">1.1.3.</span> <span class="nav-text">爬虫的分类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%88%AC%E8%99%AB%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="nav-number">1.1.4.</span> <span class="nav-text">爬虫的流程</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#http%E5%8D%8F%E8%AE%AE%E5%A4%8D%E4%B9%A0"><span class="nav-number">1.2.</span> <span class="nav-text">http协议复习</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E5%A4%B4%E5%92%8C%E5%93%8D%E5%BA%94%E5%A4%B4"><span class="nav-number">1.2.1.</span> <span class="nav-text">请求头和响应头</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81"><span class="nav-number">1.2.2.</span> <span class="nav-text">响应状态码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#http%E8%AF%B7%E6%B1%82%E8%BF%87%E7%A8%8B"><span class="nav-number">1.2.3.</span> <span class="nav-text">http请求过程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B6%E5%AE%83%E5%8F%82%E8%80%83%E9%98%85%E8%AF%BB"><span class="nav-number">1.2.4.</span> <span class="nav-text">其它参考阅读</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#requests%E6%A8%A1%E5%9D%97"><span class="nav-number">2.</span> <span class="nav-text">requests模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%80%E5%8D%95get%E8%AF%B7%E6%B1%82"><span class="nav-number">2.1.</span> <span class="nav-text">简单get请求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E4%B9%B1%E7%A0%81"><span class="nav-number">2.2.</span> <span class="nav-text">解决乱码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E5%AF%B9%E8%B1%A1"><span class="nav-number">2.3.</span> <span class="nav-text">响应对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82"><span class="nav-number">2.4.</span> <span class="nav-text">发送请求</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%90%BA%E5%B8%A6%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="nav-number">2.4.1.</span> <span class="nav-text">携带请求头</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%90%BA%E5%B8%A6%E5%8F%82%E6%95%B0%E5%AD%97%E5%85%B8"><span class="nav-number">2.4.2.</span> <span class="nav-text">携带参数字典</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%90%BA%E5%B8%A6cookie"><span class="nav-number">2.4.3.</span> <span class="nav-text">携带cookie</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#cookieJar%E5%AF%B9%E8%B1%A1"><span class="nav-number">2.4.4.</span> <span class="nav-text">cookieJar对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#timeout%E8%B6%85%E6%97%B6"><span class="nav-number">2.4.5.</span> <span class="nav-text">timeout超时</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#proxies%E4%BB%A3%E7%90%86"><span class="nav-number">2.4.6.</span> <span class="nav-text">proxies代理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#verify%E5%8F%82%E6%95%B0"><span class="nav-number">2.4.7.</span> <span class="nav-text">verify参数</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#post%E8%AF%B7%E6%B1%82"><span class="nav-number">2.5.</span> <span class="nav-text">post请求</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%88%86%E6%9E%90"><span class="nav-number">2.5.1.</span> <span class="nav-text">思路分析</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">2.5.2.</span> <span class="nav-text">代码实现</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#session"><span class="nav-number">2.6.</span> <span class="nav-text">session</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%8F%90%E5%8F%96"><span class="nav-number">3.</span> <span class="nav-text">数据提取</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E5%86%85%E5%AE%B9%E5%88%86%E7%B1%BB"><span class="nav-number">3.1.</span> <span class="nav-text">响应内容分类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#xml%E5%92%8Chtml"><span class="nav-number">3.2.</span> <span class="nav-text">xml和html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90%E6%96%B9%E6%B3%95"><span class="nav-number">3.3.</span> <span class="nav-text">数据解析方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jsonpath%E6%A8%A1%E5%9D%97"><span class="nav-number">4.</span> <span class="nav-text">jsonpath模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%E8%A7%84%E5%88%99"><span class="nav-number">4.1.</span> <span class="nav-text">语法规则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-number">4.2.</span> <span class="nav-text">使用示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#jsonpath%E7%BB%83%E4%B9%A0"><span class="nav-number">4.3.</span> <span class="nav-text">jsonpath练习</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#xpath"><span class="nav-number">5.</span> <span class="nav-text">xpath</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#xpath-helper"><span class="nav-number">5.1.</span> <span class="nav-text">xpath helper</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#xpath%E7%9A%84%E8%8A%82%E7%82%B9"><span class="nav-number">5.2.</span> <span class="nav-text">xpath的节点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#xpath%E8%AF%AD%E6%B3%95"><span class="nav-number">5.3.</span> <span class="nav-text">xpath语法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lxml%E6%A8%A1%E5%9D%97"><span class="nav-number">6.</span> <span class="nav-text">lxml模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%A8%E6%B3%95"><span class="nav-number">6.1.</span> <span class="nav-text">用法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B-1"><span class="nav-number">6.2.</span> <span class="nav-text">使用示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#etree-tostring"><span class="nav-number">6.3.</span> <span class="nav-text">etree.tostring</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#selenium"><span class="nav-number">7.</span> <span class="nav-text">selenium</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E7%8E%AF%E5%A2%83"><span class="nav-number">7.1.</span> <span class="nav-text">安装环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">7.2.</span> <span class="nav-text">工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="nav-number">7.3.</span> <span class="nav-text">简单使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="nav-number">7.4.</span> <span class="nav-text">提取数据</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#driver%E5%AF%B9%E8%B1%A1"><span class="nav-number">7.4.1.</span> <span class="nav-text">driver对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%A0%87%E7%AD%BE%E5%85%83%E7%B4%A0"><span class="nav-number">7.4.2.</span> <span class="nav-text">获取标签元素</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">7.5.</span> <span class="nav-text">其他使用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%87%E6%8D%A2%E6%A0%87%E7%AD%BE%E9%A1%B5"><span class="nav-number">7.5.1.</span> <span class="nav-text">切换标签页</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A8%E4%BD%9C%E9%93%BE%E5%92%8C%E5%88%87%E6%8D%A2iframe"><span class="nav-number">7.5.2.</span> <span class="nav-text">动作链和切换iframe</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#iframe%E6%98%AFhtml%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E4%B8%80%E7%A7%8D%E6%8A%80%E6%9C%AF%EF%BC%8C%E5%8D%B3%E4%B8%80%E4%B8%AA%E9%A1%B5%E9%9D%A2%E4%B8%AD%E5%B5%8C%E5%A5%97%E4%BA%86%E5%8F%A6%E4%B8%80%E4%B8%AA%E7%BD%91%E9%A1%B5%EF%BC%8Cselenium%E9%BB%98%E8%AE%A4%E6%98%AF%E8%AE%BF%E9%97%AE%E4%B8%8D%E4%BA%86frame%E4%B8%AD%E7%9A%84%E5%86%85%E5%AE%B9%E7%9A%84%EF%BC%8C%E5%AF%B9%E5%BA%94%E7%9A%84%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E6%98%AFdriver-switch-to-frame-frame-element-%E3%80%82%E6%8E%A5%E4%B8%8B%E6%9D%A5%E6%88%91%E4%BB%AC%E9%80%9A%E8%BF%87qq%E9%82%AE%E7%AE%B1%E6%A8%A1%E6%8B%9F%E7%99%BB%E9%99%86%E6%9D%A5%E5%AD%A6%E4%B9%A0%E8%BF%99%E4%B8%AA%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="nav-number">7.5.3.</span> <span class="nav-text">iframe是html中常用的一种技术，即一个页面中嵌套了另一个网页，selenium默认是访问不了frame中的内容的，对应的解决思路是driver.switch_to.frame(frame_element)。接下来我们通过qq邮箱模拟登陆来学习这个知识点</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%84%E7%90%86cookie"><span class="nav-number">7.5.4.</span> <span class="nav-text">处理cookie</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%89%A7%E8%A1%8Cjs%E4%BB%A3%E7%A0%81"><span class="nav-number">7.5.5.</span> <span class="nav-text">执行js代码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E7%AD%89%E5%BE%85"><span class="nav-number">7.5.6.</span> <span class="nav-text">页面等待</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%97%A0%E5%A4%B4%E6%B5%8F%E8%A7%88%E5%99%A8"><span class="nav-number">7.5.7.</span> <span class="nav-text">无头浏览器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86%E5%92%8CUA"><span class="nav-number">7.5.8.</span> <span class="nav-text">使用代理和UA</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%84%E9%81%BF%E6%A3%80%E6%B5%8B"><span class="nav-number">7.5.9.</span> <span class="nav-text">规避检测</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Linux%E9%83%A8%E7%BD%B2"><span class="nav-number">7.6.</span> <span class="nav-text">Linux部署</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%88%AC%E8%99%AB%E5%92%8C%E5%8F%8D%E7%88%AC"><span class="nav-number">8.</span> <span class="nav-text">爬虫和反爬</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E5%8F%8D%E7%88%AC%E6%89%8B%E6%AE%B5"><span class="nav-number">8.1.</span> <span class="nav-text">常见反爬手段</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E8%BA%AB%E4%BB%BD%E8%AF%86%E5%88%AB"><span class="nav-number">8.1.1.</span> <span class="nav-text">基于身份识别</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E7%88%AC%E8%99%AB%E8%A1%8C%E4%B8%BA"><span class="nav-number">8.1.2.</span> <span class="nav-text">基于爬虫行为</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86"><span class="nav-number">8.1.3.</span> <span class="nav-text">基于数据加密</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E5%A4%84%E7%90%86"><span class="nav-number">8.2.</span> <span class="nav-text">验证码处理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-number">8.2.1.</span> <span class="nav-text">图片验证码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9B%BE%E7%89%87%E8%AF%86%E5%88%AB%E5%BC%95%E6%93%8E"><span class="nav-number">8.2.2.</span> <span class="nav-text">图片识别引擎</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%89%93%E7%A0%81%E5%B9%B3%E5%8F%B0"><span class="nav-number">8.2.3.</span> <span class="nav-text">打码平台</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#chrome%E6%B5%8F%E8%A7%88%E5%99%A8"><span class="nav-number">8.3.</span> <span class="nav-text">chrome浏览器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA%E9%9A%90%E8%BA%AB%E7%AA%97%E5%8F%A3"><span class="nav-number">8.3.1.</span> <span class="nav-text">新建隐身窗口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#network"><span class="nav-number">8.3.2.</span> <span class="nav-text">network</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AF%BB%E6%89%BE%E7%99%BB%E5%BD%95%E6%8E%A5%E5%8F%A3"><span class="nav-number">8.3.3.</span> <span class="nav-text">寻找登录接口</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JS%E8%A7%A3%E6%9E%90"><span class="nav-number">8.4.</span> <span class="nav-text">JS解析</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A1%AE%E5%AE%9Ajs%E4%BD%8D%E7%BD%AE"><span class="nav-number">8.4.1.</span> <span class="nav-text">确定js位置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%82%E5%AF%9Fjs%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="nav-number">8.4.2.</span> <span class="nav-text">观察js执行过程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#js2py%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">8.4.3.</span> <span class="nav-text">js2py的使用</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">8.5.</span> <span class="nav-text">小结</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yanglinqi"
      src="/images/headpic.jpg">
  <p class="site-author-name" itemprop="name">yanglinqi</p>
  <div class="site-description" itemprop="description">用于做笔记，对学过的知识总结</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">100</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yanglinqi107" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yanglinqi107" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yanglinqi</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.1.0/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  


  <script async src="/js/cursor/fireworks.js"></script>


</body>
</html>
